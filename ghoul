-- Generated at discord.gg/xeshub
-- Anti-Cheat Bypass
local hook; hook = hookmetamethod(game, "__namecall", newcclosure(function(self, ...)
    local method = getnamecallmethod()
    if method == "FireServer" and self:IsA("RemoteEvent") and self.Parent == game:GetService("ReplicatedStorage"):FindFirstChild("Remotes") then
        if self.Name == "VFX" or self.Name == "OnUpdate" or self.Name == "UpdateStun" or self.Name == "SoundEvent" or self.Name == "UpdateSlotData" or self.Name == "RePlayer" or self.Name == "TeleportEvent" or self.Name == "ProductEvent" or self.Name == "Interact" or self.Name == "CooldownRemote" or self.Name == "UpdateLives" or self.Name == "UpdatePlayerSettings" or self.Name == "UpdateResourceBar" or self.Name == "Chat" or self.Name == "UpdateELORanking" or self.Name == "UpdateEquipment" or self.Name == "SendPartyMarker" or self.Name == "UpdatePoints" or self.Name == "GhoulPoint" or self.Name == "HandleSurfaceGUI" or self.Name == "BarrierPush" or self.Name == "GetKeybinds" or self.Name == "Party" or self.Name == "GiftAction" or self.Name == "EmoteShopEvent" or self.Name == "ExploitReport" or self.Name == "CutsceneRemote" or self.Name == "VoteEvent" or self.Name == "ResetSettings" or self.Name == "SettingsResetFlag" or self.Name == "HUDCooldownUpdate" or self.Name == "DevPlaceTP" or self.Name == "TeleportFloor" or self.Name == "PutInBank" or self.Name == "QuinqueStorageInitialize" or self.Name == "QuinqueStorageWeaponSwap" or self.Name == "ViewCMD" or self.Name == "FreeRankup" or self.Name == "DisablePVPShield" or self.Name == "UpdateUIPositions" or self.Name == "GuideBeamRemote" or self.Name == "MobileSkills" or self.Name == "SkinReroll" or self.Name == "GamepassThing" or self.Name == "CheckSettings" or self.Name == "TradeRemote" or self.Name == "RemoveBlackScreen" or self.Name == "ConfirmClanAction" or self.Name == "CloseClanListUI" or self.Name == "UpdateLeaderBoard" or self.Name == "ClanHandling" or self.Name == "ClanWarUI" or self.Name == "UpdateClanListUI" or self.Name == "KickClanMember" or self.Name == "InviteClanMember" or self.Name == "JoinClanInvite" or self.Name == "CloseClanUI" or self.Name == "TransformRemote" or self.Name == "TransformRequest" or self.Name == "TransformSkillCast" or self.Name == "UpdateEtoModelClient" or self.Name == "ToggleShiftEto" or self.Name == "UpdateEtoModel" or self.Name == "JoinCCPrivateServer" or self.Name == "CreateClan" or self.Name == "DisbandClan" or self.Name == "LeaveClan" or self.Name == "Grip" or self.Name == "Carry" or self.Name == "ToggleShiftTatara" or self.Name == "UpdateTataraModel" or self.Name == "UpdateTataraModelClient" or self.Name == "FXRemote" or self.Name == "ReplayRanked" or self.Name == "PromoteClanMember" or self.Name == "FX" or self.Name == "ShowBoxReceived" or self.Name == "ChangeSkillText" or self.Name == "UpdateCochlea" or self.Name == "QuinqueStorageAttemptPurchase" or self.Name == "SellEquipment" or self.Name == "ProjectileEffects" or self.Name == "Groundcast" or self.Name == "Lighting" then
        else
            print("Anti-cheat bypassed")
            return
        end
    end
    
    return hook(self, ...)
end))

print("Anti-cheat Bypass loaded successfully")


repeat wait() until game:IsLoaded()
print("Game Loaded")
repeat task.wait() until game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
print("Character loaded")

local libUrl = "https://raw.githubusercontent.com/Yv50/Ui-lib/main/"
local Library = loadstring(game:HttpGet(libUrl .. "Library.lua"))()
local ThemeManager = loadstring(game:HttpGet(libUrl .. "addons/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet(libUrl .. "addons/SaveManager.lua"))()
local PlayerESP = loadstring(game:HttpGet("https://raw.githubusercontent.com/Yv50/testing-stuff/refs/heads/main/pre"))()

local Window = Library:CreateWindow({
    Title = "XES Hub | Ghoul:RE Free",
    Center = true,
    AutoShow = true,
    TabPadding = 8
})

local Tabs = {
    PlayerTab = Window:AddTab("Players"),
    WorldTab = Window:AddTab("World"),
    VisualTab = Window:AddTab("Visual"),
    MiscTab = Window:AddTab("Miscs"),
    ["UI Settings"] = Window:AddTab("UI Settings")
}

local PlayerGroup = Tabs.PlayerTab:AddLeftGroupbox("< Local Player >")
local CameraGroup = Tabs.PlayerTab:AddRightGroupbox("< Camera >")
local WorldGroup = Tabs.WorldTab:AddLeftGroupbox("< Main >")
local ESPGroup = Tabs.VisualTab:AddLeftGroupbox("< ESP >")
local VisualMiscGroup = Tabs.VisualTab:AddRightGroupbox("< Miscs >")
local MiscGroup = Tabs.MiscTab:AddLeftGroupbox("< Main >")

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Lighting = game:GetService("Lighting")
local HttpService = game:GetService("HttpService")
local Camera = workspace.CurrentCamera
local GuiService = game:GetService("GuiService")
local TeleportService = game:GetService("TeleportService")

local Settings = {
    noanims = false,
    flying = false,
    noclip = false,
    flyingSpeed = 100,
    speedhack = false,
    speedhackWalkSpeed = 100,
    infJump = false,
    infjumpheight = 50,
    VoidMob = false,
    AutoLoot = false,
    ModNotifer = false,
    kickifmod = false,
    killaurahp = 100,
    killauraifcreds = false,
    autofarmplayers = false,
    fullbright = false,
    Brightness = 0,
    spectateplayers = false,
    autoloot = false,
    autofragment = false,
    fpsunlocker = false,
    aimbotEnabled = false,
    aimbotPlayers = false,
    aimbotMobs = false,
    aimbotVisible = false,
    aimbotFOV = 45,
    aimbotMode = "Toggle",
    aimbotActive = false,
    showFov = false,
    aimbotXOffset = 0,
    aimbotYOffset = 0,
    bringmobs = false,
    bringmobsrange = 1000,
    bringmobsdistance = 50,
    fovchanger = false,
    CameraFOV = 70,
    bypassSpeed = false,
    autogrip = false,
    autoequip = false,
    autocrit = false,
    autoswing = false,
    autouppercut = false,
    autoperfectroll = false
}

local function getDistance(pos1, pos2)
    return (pos1 - pos2).Magnitude
end

local function teleportTo(x, y, z)
    local args = {{Module = "Dash"}, "\5"}
    game:GetService("ReplicatedStorage"):WaitForChild("Bridgenet2Main"):WaitForChild("dataRemoteEvent"):FireServer(unpack({args}))
    game.Players.LocalPlayer.Character.PrimaryPart.CFrame = CFrame.new(x, y, z)
end

local function serverHop()
    local url = "https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"
    
    local function getPage(cursor)
        return HttpService:JSONDecode(game:HttpGet(url .. (cursor and "&cursor=" .. cursor or "")))
    end
    
    local nextCursor = nil
    while true do
        local page = getPage(nextCursor)
        local server = page.data[math.random(1, #page.data / 3)]
        nextCursor = page.nextPageCursor
        
        if server and server.playing < server.maxPlayers and server.id ~= game.JobId then
            break
        end
        
        if not nextCursor then
            warn("No suitable server found, retrying...")
            serverHop()
            return
        end
    end
    
    TeleportService:TeleportToPlaceInstance(game.PlaceId, server.id, game.Players.LocalPlayer)
end

local function tweenTo(targetCFrame, speed)
    local char = game.Players.LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        local hrp = char.HumanoidRootPart
        local startCFrame = hrp.CFrame
        local startTime = tick()
        local duration = (startCFrame.Position - targetCFrame.Position).Magnitude / speed
        
        hrp.AssemblyLinearVelocity = Vector3.new()
        hrp.AssemblyAngularVelocity = Vector3.new()
        
        local connection = nil
        connection = RunService.RenderStepped:Connect(function()
            local elapsed = tick() - startTime
            if duration > elapsed then
                local alpha = elapsed / duration
                hrp.AssemblyLinearVelocity = Vector3.new()
                hrp.AssemblyAngularVelocity = Vector3.new()
                hrp.CFrame = startCFrame:Lerp(targetCFrame, alpha)
            else
                hrp.AssemblyLinearVelocity = Vector3.new()
                hrp.AssemblyAngularVelocity = Vector3.new()
                hrp.CFrame = targetCFrame
                connection:Disconnect()
            end
        end)
    end
end

-- Flying
local flyBodyVel = nil
local flyTarget = nil
local flyHrp = nil
local flyHum = nil
local flyConnection = nil

local function setupFly()
    local char = game.Players.LocalPlayer.Character
    if not (flyBodyVel and flyBodyVel.Parent) then
        flyBodyVel = Instance.new("BodyVelocity")
        flyBodyVel.Velocity = Vector3.new(0, 0, 0)
        flyBodyVel.MaxForce = Vector3.new(math.huge, 0, math.huge)
        flyBodyVel.Parent = char:FindFirstChild("Torso")
    end
end

local function getMoveDir()
    local dir = Vector3.new(0, 0, 0)
    local camCF = workspace.CurrentCamera.CFrame
    local forward = Vector3.new(camCF.LookVector.X, 0, camCF.LookVector.Z).Unit
    local right = Vector3.new(camCF.RightVector.X, 0, camCF.RightVector.Z).Unit
    
    if UserInputService:IsKeyDown(Enum.KeyCode.W) then dir = dir + forward end
    if UserInputService:IsKeyDown(Enum.KeyCode.S) then dir = dir - forward end
    if UserInputService:IsKeyDown(Enum.KeyCode.A) then dir = dir - right end
    if UserInputService:IsKeyDown(Enum.KeyCode.D) then dir = dir + right end
    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then dir = dir + Vector3.new(0, 1, 0) end
    if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then dir = dir - Vector3.new(0, 1, 0) end
    
    return dir.Magnitude > 0 and dir.Unit or Vector3.new(0, 0, 0)
end

local function flyTick(delta)
    if Settings.flying and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        flyHrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        flyHum = LocalPlayer.Character:FindFirstChild("Humanoid")
        
        if flyHum then
            flyHum.PlatformStand = true
        end
        
        if not flyTarget then
            flyTarget = flyHrp.CFrame
        end
        
        local moveDir = getMoveDir()
        if moveDir.Magnitude > 0 then
            flyTarget = flyTarget + moveDir * Settings.flyingSpeed * delta
        end
        
        local lookDir = workspace.CurrentCamera.CFrame.LookVector
        local horizLook = Vector3.new(lookDir.X, 0, lookDir.Z).Unit
        if horizLook.Magnitude > 0 then
            flyTarget = CFrame.new(flyTarget.Position, flyTarget.Position + horizLook)
        end
        
        flyHrp.AssemblyLinearVelocity = Vector3.new()
        flyHrp.CFrame = flyTarget
    elseif flyHrp and flyHum then
        flyHum.PlatformStand = false
    end
end

local function toggleFly(state)
    Settings.flying = state
    if Settings.flying then
        RunService:BindToRenderStep("Fly", Enum.RenderPriority.Input.Value, flyTick)
    else
        RunService:UnbindFromRenderStep("Fly")
        flyTarget = nil
    end
end

-- Speedhack
local function speedTick()
    if not Settings.flying then
        local char = game.Players.LocalPlayer.Character
        if Settings.speedhack and char and char:FindFirstChild("HumanoidRootPart") then
            setupFly()
            local hum = char:FindFirstChild("Humanoid")
            if hum then
                local moveDir = hum.MoveDirection
                if moveDir and moveDir.Magnitude > 0 then
                    flyBodyVel.Velocity = moveDir * ((Settings.speedhackWalkSpeed + hum.WalkSpeed) / 2)
                else
                    flyBodyVel.Velocity = Vector3.new(0, 0, 0)
                end
            end
        elseif flyBodyVel then
            flyBodyVel:Destroy()
            flyBodyVel = nil
        end
    end
end

local function infJumpLoop(enabled)
    if not enabled then return end
    
    while true do
        local hrp = game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp and UserInputService:IsKeyDown(Enum.KeyCode.Space) then
            hrp.Velocity = Vector3.new(hrp.Velocity.X, Settings.infjumpheight, hrp.Velocity.Z)
        end
        task.wait(0.1)
        if not (Settings.infJump and enabled) then
            return
        end
    end
end

local function toggleSpeed(state)
    Settings.speedhack = state
    if Settings.speedhack then
        RunService:BindToRenderStep("Speedhack", Enum.RenderPriority.Input.Value + (Settings.flying and 1 or 0), speedTick)
    else
        RunService:UnbindFromRenderStep("Speedhack")
        if flyBodyVel then
            flyBodyVel:Destroy()
            flyBodyVel = nil
        end
    end
end

-- Player Tab
PlayerGroup:AddToggle("Fly", {
    Text = "Fly",
    Default = false,
    Tooltip = "Fly",
    Callback = function(value)
        toggleFly(value)
    end
}):AddKeyPicker("FlyKeybind", {
    Default = "Y",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Fly Keybind",
    NoUI = false
})

PlayerGroup:AddSlider("FlySpeed", {
    Text = "Fly Speed",
    Default = 100,
    Min = 0,
    Max = 1000,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        Settings.flyingSpeed = value
    end
})

PlayerGroup:AddToggle("Speedhack", {
    Text = "Speedhack",
    Default = false,
    Tooltip = "Speedhack",
    Callback = function(value)
        toggleSpeed(value)
        local player = game.Players.LocalPlayer
        if value then
            if not flyConnection then
                flyConnection = player.CharacterAdded:Connect(function()
                    if flyBodyVel then
                        flyBodyVel:Destroy()
                        flyBodyVel = nil
                    end
                    if Settings.speedhack then
                        toggleSpeed(false)
                        toggleSpeed(true)
                    end
                end)
            end
        elseif flyConnection then
            flyConnection:Disconnect()
            flyConnection = nil
        end
    end
}):AddKeyPicker("SpeedhackKeybind", {
    Default = "N",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Speedhack Keybind",
    NoUI = false
})

PlayerGroup:AddSlider("Speedhack Speed", {
    Text = "Speedhack Speed",
    Default = 100,
    Min = 0,
    Max = 1000,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        Settings.speedhackWalkSpeed = value
    end
})

PlayerGroup:AddToggle("Infinite Jump", {
    Text = "Infinite Jump",
    Default = false,
    Tooltip = "Infinite Jump",
    Callback = function(value)
        Settings.infJump = value
        if Settings.infJump then
            infJumpLoop(true)
        end
    end
}):AddKeyPicker("InfiniteJumpKeybind", {
    Default = "H",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Infinite Jump Keybind",
    NoUI = false
})

PlayerGroup:AddSlider("InfiniteJump Height", {
    Text = "InfiniteJump Height",
    Default = 50,
    Min = 0,
    Max = 1000,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        Settings.infjumpheight = value
    end
})

-- Noclip
local noclipConnection = nil
PlayerGroup:AddToggle("Noclip", {
    Text = "Noclip",
    Default = false,
    Tooltip = "noclip",
    Callback = function(value)
        Settings.noclip = value
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
        
        if value then
            if LocalPlayer.Character then
                local head = LocalPlayer.Character:FindFirstChild("Head")
                local torso = LocalPlayer.Character:FindFirstChild("Torso")
                if head then head.CanCollide = false end
                if torso then torso.CanCollide = false end
            end
            
            noclipConnection = RunService.RenderStepped:Connect(function()
                if Settings.noclip and LocalPlayer.Character then
                    local head = LocalPlayer.Character:FindFirstChild("Head")
                    local torso = LocalPlayer.Character:FindFirstChild("Torso")
                    if head then head.CanCollide = false end
                    if torso then torso.CanCollide = false end
                end
            end)
        elseif LocalPlayer.Character then
            local head = LocalPlayer.Character:FindFirstChild("Head")
            local torso = LocalPlayer.Character:FindFirstChild("Torso")
            if head then head.CanCollide = true end
            if torso then torso.CanCollide = true end
        end
    end
}):AddKeyPicker("NoclipKeybind", {
    Default = "",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Noclip Keybind",
    NoUI = false
})

PlayerGroup:AddToggle("Bypass Anti-Speed", {
    Text = "Bypass Anti-Speed",
    Default = false,
    Tooltip = "Bypass Anti-Speed",
    Callback = function(value)
        Settings.bypassSpeed = value
        if Settings.bypassSpeed then
            while Settings.bypassSpeed and task.wait() do
                local args = {{{Module = "Dash"}, "\5"}}
                game:GetService("ReplicatedStorage"):WaitForChild("Bridgenet2Main"):WaitForChild("dataRemoteEvent"):FireServer(unpack(args))
            end
        end
    end
})

PlayerGroup:AddToggle("AutoM1", {
    Text = "Auto M1",
    Default = false,
    Tooltip = "Auto M1",
    Callback = function(value)
        Settings.autoswing = value
        if Settings.autoswing then
            repeat
                local args = {{{Module = "M1"}, "\5"}}
                game:GetService("ReplicatedStorage"):WaitForChild("Bridgenet2Main", 9000000000):WaitForChild("dataRemoteEvent", 9000000000):FireServer(unpack(args))
                task.wait(0.1)
            until not Settings.autoswing
        end
    end
}):AddKeyPicker("AutoM1Keybind", {
    Default = "",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Auto M1 Keybind",
    NoUI = false
})

PlayerGroup:AddToggle("AutoCrit", {
    Text = "Auto Critical",
    Default = false,
    Tooltip = "Auto Critical",
    Callback = function(value)
        Settings.autocrit = value
        if Settings.autocrit then
            repeat
                local args = {{{Module = "M2"}, "\5"}}
                game:GetService("ReplicatedStorage"):WaitForChild("Bridgenet2Main", 9000000000):WaitForChild("dataRemoteEvent", 9000000000):FireServer(unpack(args))
                task.wait()
            until not Settings.autocrit
        end
    end
}):AddKeyPicker("autocritKeybind", {
    Default = "",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Auto Crit Keybind",
    NoUI = false
})

PlayerGroup:AddToggle("AutoUppercut", {
    Text = "Auto Uppercut",
    Default = false,
    Tooltip = "Auto Uppercut",
    Callback = function(value)
        Settings.autouppercut = value
        if Settings.autouppercut then
            repeat
                local args = {{{Module = "Uppercut"}, "\5"}}
                game:GetService("ReplicatedStorage"):WaitForChild("Bridgenet2Main", 9000000000):WaitForChild("dataRemoteEvent", 9000000000):FireServer(unpack(args))
                task.wait(0.1)
            until not Settings.autouppercut
        end
    end
}):AddKeyPicker("AutoUppercutKeybind", {
    Default = "",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Auto Uppercut Keybind",
    NoUI = false
})

local perfectRollConnection = nil
PlayerGroup:AddToggle("autoPerfectRoll", {
    Text = "Auto Perfect Roll",
    Default = false,
    Tooltip = "Auto Perfect Roll",
    Callback = function(value)
        Settings.autoperfectroll = value
        if perfectRollConnection then
            perfectRollConnection:Disconnect()
            perfectRollConnection = nil
        end
        
        if Settings.autoperfectroll then
            perfectRollConnection = UserInputService.InputBegan:Connect(function(input)
                if input.KeyCode == Enum.KeyCode.Q then
                    task.wait(Options.AutoPerfectRollDelay.Value)
                    mouse2click()
                end
            end)
        end
    end
}):AddKeyPicker("AutoPerfectRollKeybind", {
    Default = "",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Auto Perfect Roll Keybind",
    NoUI = false
})

PlayerGroup:AddSlider("AutoPerfectRollDelay", {
    Text = "Auto Perfect Roll Delay",
    Default = 0,
    Min = 0,
    Max = 1,
    Rounding = 1,
    Compact = true
})

PlayerGroup:AddToggle("Auto Fragment", {
    Text = "Auto Fragment",
    Default = false,
    Tooltip = "Auto Fragment",
    Callback = function(value)
        Settings.autofragment = value
        if Settings.autofragment then
            task.spawn(function()
                for _, tool in ipairs(LocalPlayer.Backpack:GetChildren()) do
                    if string.find(tool.Name, "Fragment") then
                        tool.Parent = LocalPlayer.Character
                        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
                        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
                        task.wait()
                        tool.Parent = LocalPlayer.Backpack
                    end
                end
                task.wait()
                if not Settings.autofragment then return end
            end)
        end
    end
}):AddKeyPicker("AutoFragmentKeybind", {
    Default = "",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Auto Fragment Keybind",
    NoUI = false
})

-- Auto Loot
game:GetService("Players").LocalPlayer.PlayerGui.ChildAdded:Connect(function(child)
    if child.Name == "BagGui" and Settings.AutoLoot then
        local itemsFrame = child.Frame.ItemsFrame
        for _, button in pairs(itemsFrame:GetChildren()) do
            if button:IsA("TextButton") then
                GuiService.SelectedObject = button
                task.wait(0.1)
                VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
                task.wait(0)
                VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
                button.Active = false
                button.AutoButtonColor = false
                button.BackgroundColor3 = Color3.fromRGB(128, 128, 128)
                GuiService.SelectedObject = nil
            end
        end
    end
end)

PlayerGroup:AddToggle("AutoLoot", {
    Text = "Auto Loot",
    Default = false,
    Tooltip = "Auto Loot items",
    Callback = function(value)
        Settings.AutoLoot = value
        if value then
            for _, button in pairs(game:GetService("Players").LocalPlayer.PlayerGui:WaitForChild("BagGui").Frame.ItemsFrame:GetChildren()) do
                if button:IsA("TextButton") then
                    GuiService.SelectedObject = button
                    task.wait(0.1)
                    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
                    task.wait(0.1)
                    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
                    button.Active = false
                    button.AutoButtonColor = false
                    button.BackgroundColor3 = Color3.fromRGB(128, 128, 128)
                    GuiService.SelectedObject = nil
                end
            end
        end
    end
}):AddKeyPicker("AutoLootKeybind", {
    Default = "",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Auto Loot Keybind",
    NoUI = false
})

-- No Anims
local noAnimsTask = nil
local noAnimsConnection = nil
local loadedAnims = {}
local stoppedAnims = {}

PlayerGroup:AddToggle("No Anims", {
    Text = "No Anims",
    Default = false,
    Tooltip = "Freezes character animations",
    Callback = function(value)
        Settings.noanims = value
        
        if noAnimsTask then
            task.cancel(noAnimsTask)
            noAnimsTask = nil
        end
        
        if noAnimsConnection then
            noAnimsConnection:Disconnect()
            noAnimsConnection = nil
        end
        
        if Settings.noanims then
            local function handleChar(char)
                local hum = char:FindFirstChildOfClass("Humanoid") or char:WaitForChild("Humanoid", 2)
                if hum then
                    local animator = hum:FindFirstChildOfClass("Animator") or hum:WaitForChild("Animator", 2)
                    if animator then
                        local freezeAnim = Instance.new("Animation")
                        freezeAnim.AnimationId = "http://www.roblox.com/asset/?id=109212722752"
                        
                        noAnimsTask = task.spawn(function()
                            while Settings.noanims and hum and hum.Parent do
                                local foundFreeze = nil
                                for _, track in pairs(animator:GetPlayingAnimationTracks()) do
                                    if track.Animation.AnimationId == freezeAnim.AnimationId then
                                        foundFreeze = track
                                    else
                                        if not table.find(stoppedAnims, track) then
                                            table.insert(stoppedAnims, track)
                                        end
                                        pcall(function()
                                            track:Stop()
                                            task.defer(track.Destroy, track)
                                        end)
                                    end
                                end
                                
                                if not foundFreeze then
                                    local freezeTrack = animator:LoadAnimation(freezeAnim)
                                    table.insert(loadedAnims, freezeTrack)
                                    freezeTrack.Priority = Enum.AnimationPriority.Core
                                    freezeTrack:AdjustSpeed(0)
                                    freezeTrack:Play()
                                end
                                task.wait(0.1)
                            end
                        end)
                    end
                else
                    return
                end
            end
            
            if LocalPlayer.Character then
                handleChar(LocalPlayer.Character)
            end
            
            noAnimsConnection = LocalPlayer.CharacterAdded:Connect(handleChar)
        else
            for _, track in pairs(loadedAnims) do
                pcall(function()
                    track:Stop()
                    track:Destroy()
                end)
            end
            loadedAnims = {}
            
            for _, track in pairs(stoppedAnims) do
                pcall(function()
                    track:Play()
                end)
            end
            stoppedAnims = {}
        end
    end
}):AddKeyPicker("NoAnimsKeybind", {
    Default = "",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "No Anims Keybind",
    NoUI = false
})

PlayerGroup:AddToggle("Auto Grip", {
    Text = "Auto Grip",
    Default = false,
    Tooltip = "Auto Grip",
    Callback = function(value)
        Settings.autogrip = value
        if Settings.autogrip then
            task.spawn(function()
                while Settings.autogrip and task.wait() do
                    local nearestDist = math.huge
                    local nearestChar = nil
                    
                    for _, char in ipairs(workspace.Entities:GetChildren()) do
                        if char ~= Character and char:FindFirstChild("Humanoid") and char:FindFirstChild("HumanoidRootPart") then
                            local hum = char.Humanoid
                            local dist = (char.HumanoidRootPart.Position - Character.PrimaryPart.Position).Magnitude
                            
                            if dist <= 5 and hum.Health <= 2.5 then
                                if dist < nearestDist then
                                    nearestChar = char
                                    nearestDist = dist
                                end
                            end
                        end
                    end
                    
                    if nearestChar then
                        local args = {{{Module = "Grip"}, "\5"}}
                        game:GetService("ReplicatedStorage"):WaitForChild("Bridgenet2Main"):WaitForChild("dataRemoteEvent"):FireServer(unpack(args))
                        
                        repeat
                            task.wait(0)
                            local targetHrp = nearestChar:FindFirstChild("HumanoidRootPart")
                        until not targetHrp or (targetHrp.Position - Character.PrimaryPart.Position).Magnitude > 6 or not nearestChar.Parent or nearestChar:FindFirstChild("Humanoid").Health <= 0
                    end
                end
            end)
        end
    end
})

PlayerGroup:AddToggle("Auto Equip", {
    Text = "Auto Equip",
    Default = false,
    Tooltip = "Auto Equip",
    Callback = function(value)
        Settings.autoequip = value
        if Settings.autoequip then
            while Settings.autoequip and task.wait(0.1) do
                if not Character:GetAttribute("CombatMode") then
                    local args = {{{Module = "Toggle", IsHolding = true}, "\5"}}
                    game:GetService("ReplicatedStorage"):WaitForChild("Bridgenet2Main", 9000000000):WaitForChild("dataRemoteEvent", 9000000000):FireServer(unpack(args))
                end
            end
        end
    end
})

PlayerGroup:AddButton({
    Text = "Kill Yourself",
    Func = function()
        game.Players.LocalPlayer.Character:FindFirstChild("Humanoid"):TakeDamage(math.huge)
    end,
    Tooltip = "Commit Suicide"
})

-- Aimbot
local function getTargetableEntities()
    local entities = {}
    
    for _, char in ipairs(workspace.Entities:GetChildren()) do
        if char ~= Character then
            local isPlayer = Players:FindFirstChild(char.Name) ~= nil
            if (Settings.aimbotPlayers and isPlayer) or (Settings.aimbotMobs and not isPlayer) then
                table.insert(entities, char)
            end
        end
    end
    
    return entities
end

local function isVisible(part)
    local ray = Ray.new(Camera.CFrame.Position, (part.Position - Camera.CFrame.Position).Unit * 1000)
    local hitPart = workspace:FindPartOnRayWithIgnoreList(ray, {Character, Camera})
    
    if hitPart then
        hitPart = hitPart:IsDescendantOf(part.Parent)
    end
    
    return hitPart
end

local function getClosestTarget()
    local nearestDist = math.huge
    local nearestTarget = nil
    
    for _, char in ipairs(getTargetableEntities()) do
        local targetPart = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Head")
        
        if targetPart then
            local screenPos = Camera:WorldToViewportPoint(targetPart.Position)
            
            if math.deg(math.acos(Camera.CFrame.LookVector:Dot((targetPart.Position - Camera.CFrame.Position).Unit))) <= Settings.aimbotFOV / 2 then
                if not Settings.aimbotVisible or isVisible(targetPart) then
                    local mousePos = UserInputService:GetMouseLocation()
                    local dist = (Vector2.new(mousePos.X, mousePos.Y) - Vector2.new(screenPos.X, screenPos.Y)).Magnitude
                    
                    if dist < nearestDist then
                        nearestTarget = targetPart
                        nearestDist = dist
                    end
                end
            end
        end
    end
    
    return nearestTarget
end

local aimbotConnection = nil
CameraGroup:AddToggle("Aimbot", {
    Text = "Aimbot",
    Default = false,
    Tooltip = "Aimbot",
    Callback = function(value)
        Settings.aimbotEnabled = value
        
        if not Settings.aimbotEnabled then
            Settings.aimbotActive = false
        end
        
        if aimbotConnection then
            aimbotConnection:Disconnect()
            aimbotConnection = nil
        end
        
        if Settings.aimbotEnabled then
            aimbotConnection = RunService.RenderStepped:Connect(function()
                local target = Settings.aimbotActive and getClosestTarget()
                
                if target then
                    local targetPos = target.Position
                    
                    if Settings.aimbotXOffset ~= 0 or Settings.aimbotYOffset ~= 0 then
                        local screenPos = Camera:WorldToViewportPoint(targetPos)
                        local adjustedScreenPos = Vector2.new(screenPos.X + Settings.aimbotXOffset, screenPos.Y + Settings.aimbotYOffset)
                        local ray = Camera:ViewportPointToRay(adjustedScreenPos.X, adjustedScreenPos.Y)
                        targetPos = ray.Origin + ray.Direction * 100
                    end
                    
                    Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPos)
                end
            end)
        end
    end
})

CameraGroup:AddLabel("Aimbot Keybind"):AddKeyPicker("AimbotKeybind", {
    Default = "MB2",
    SyncToggleState = false,
    Mode = "Hold",
    Text = "Aimbot Keybind",
    NoUI = true,
    Callback = function(value)
        Settings.aimbotActive = value
    end
})

CameraGroup:AddToggle("Aimbot Players", {
    Text = "Target Players",
    Default = false,
    Tooltip = "Target other players",
    Callback = function(value)
        Settings.aimbotPlayers = value
    end
})

CameraGroup:AddToggle("Aimbot Mobs", {
    Text = "Target Mobs",
    Default = false,
    Tooltip = "Target Mobs",
    Callback = function(value)
        Settings.aimbotMobs = value
    end
})

CameraGroup:AddToggle("Visible Only", {
    Text = "Visible Only",
    Default = false,
    Tooltip = "Only target visible enemies",
    Callback = function(value)
        Settings.aimbotVisible = value
    end
})

CameraGroup:AddSlider("Aimbot X Offset", {
    Text = "Aimbot X Offset",
    Default = 0,
    Min = -300,
    Max = 300,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        Settings.aimbotXOffset = value
    end
})

CameraGroup:AddSlider("Aimbot Y Offset", {
    Text = "Aimbot Y Offset",
    Default = 0,
    Min = -300,
    Max = 300,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        Settings.aimbotYOffset = value
    end
})

-- FOV Circle
local fovCircle = nil

local function getFovRadius()
    return math.tan(math.rad(1)) * (Camera.ViewportSize.Y / 2)
end

CameraGroup:AddToggle("Show FOV", {
    Text = "Show FOV",
    Default = false,
    Tooltip = "Show FOV",
    Callback = function(value)
        Settings.showFov = value
        
        if value then
            if not fovCircle then
                fovCircle = Drawing.new("Circle")
                fovCircle.Thickness = 1
                fovCircle.NumSides = 100
                fovCircle.Filled = false
                fovCircle.Color = Color3.fromRGB(255, 255, 255)
                fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
            end
            fovCircle.Visible = true
        elseif fovCircle then
            fovCircle.Visible = false
        end
    end
})

CameraGroup:AddSlider("Aimbot FOV", {
    Text = "Aimbot FOV",
    Default = 45,
    Min = 1,
    Max = 120,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        Settings.aimbotFOV = value
        if Settings.showFov and fovCircle then
            fovCircle.Radius = value * getFovRadius()
        end
    end
})

local function updateFovCircle()
    if fovCircle then
        fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
        fovCircle.Radius = Settings.aimbotFOV * getFovRadius()
    end
end

Camera:GetPropertyChangedSignal("ViewportSize"):Connect(updateFovCircle)
Camera:GetPropertyChangedSignal("FieldOfView"):Connect(updateFovCircle)

CameraGroup:AddToggle("FOV Changer", {
    Text = "FOV Changer",
    Default = false,
    Tooltip = "Fov Changer",
    Callback = function(value)
        Settings.fovchanger = value
        if Settings.fovchanger then
            Camera.FieldOfView = Settings.CameraFOV
        else
            Camera.FieldOfView = 70
        end
    end
})

CameraGroup:AddSlider("FOV", {
    Text = "Field of View",
    Default = 70,
    Min = 0,
    Max = 120,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        if Settings.fovchanger then
            Camera.FieldOfView = value
        end
    end
})

-- ESP System
local ESPSettings = {
    PlayerESP = false,
    mobESP = false,
    npcESP = false,
    ESPObjects = {},
    NPCESPOBjects = {},
    PlayerEspObjects = {},
    ActiveMobs = {},
    ActiveNPCs = {},
    ActivePlayers = {},
    fontSize = 14,
    espDistance = 1000,
    MobESPColor = Color3.new(1, 1, 1),
    NpcESPColor = Color3.new(0, 1, 0),
    PlayerESPColor = Color3.new(1, 1, 1)
}

local function createText(color)
    local text = Drawing.new("Text")
    text.Visible = false
    text.Center = true
    text.Outline = true
    text.Color = color
    text.Size = ESPSettings.fontSize
    return text
end

local function removeESP(entity, objects, activeTable)
    if activeTable[entity] then
        local espData = activeTable[entity]
        if espData.espText then
            espData.espText:Remove()
        end
        activeTable[entity] = nil
    end
end

local function removeMobESP(entity)
    if ESPSettings.ActiveMobs[entity] then
        local espData = ESPSettings.ActiveMobs[entity]
        if espData.espText then
            espData.espText:Remove()
        end
        if espData.highlight then
            espData.highlight:Destroy()
        end
        ESPSettings.ActiveMobs[entity] = nil
    end
end

local function setupNPCESP(npc)
    if npc and npc:IsA("Model") and not ESPSettings.ActiveNPCs[npc] then
        local hrp = npc:FindFirstChild("HumanoidRootPart")
        if hrp then
            local espText = createText(ESPSettings.NpcESPColor)
            espText.Visible = false
            table.insert(ESPSettings.NPCESPOBjects, espText)
            
            local espData = {espText = espText}
            ESPSettings.ActiveNPCs[npc] = espData
            
            local renderName = "UpdateNpcESP_" .. npc:GetDebugId()
            
            local function update()
                if npc and npc.Parent and ESPSettings.npcESP then
                    local char = LocalPlayer.Character
                    if char then
                        local playerHrp = char:FindFirstChild("HumanoidRootPart")
                        if playerHrp then
                            local dist = (hrp.Position - playerHrp.Position).Magnitude
                            local screenPos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
                            
                            if dist > ESPSettings.espDistance or not onScreen then
                                espText.Visible = false
                            else
                                espText.Text = string.format("[%s][Dist: %.1f]", npc.Name, dist)
                                espText.Size = ESPSettings.fontSize
                                espText.Position = Vector2.new(screenPos.X, screenPos.Y - 50)
                                espText.Visible = true
                            end
                        end
                    else
                        return
                    end
                else
                    RunService:UnbindFromRenderStep(renderName)
                    removeESP(npc, ESPSettings.NPCESPOBjects, ESPSettings.ActiveNPCs)
                    return
                end
            end
            
            RunService:BindToRenderStep(renderName, Enum.RenderPriority.Camera.Value + 1, update)
            
            npc.AncestryChanged:Connect(function(_, parent)
                if not parent then
                    RunService:UnbindFromRenderStep(renderName)
                    removeESP(npc, ESPSettings.NPCESPOBjects, ESPSettings.ActiveNPCs)
                end
            end)
        end
    else
        return
    end
end

local function setupMobESP(mob)
    if mob and mob:IsA("Model") and not ESPSettings.ActiveMobs[mob] then
        local hum = mob:FindFirstChildOfClass("Humanoid")
        local hrp = mob:FindFirstChild("HumanoidRootPart")
        
        if hum and hrp then
            local espText = createText(ESPSettings.MobESPColor)
            espText.Visible = false
            table.insert(ESPSettings.ESPObjects, espText)
            
            local highlight = Instance.new("Highlight")
            highlight.Parent = mob
            highlight.FillColor = ESPSettings.MobESPColor
            highlight.Enabled = false
            
            local espData = {
                espText = espText,
                highlight = highlight
            }
            ESPSettings.ActiveMobs[mob] = espData
            
            local renderName = "UpdateESP_" .. mob:GetDebugId()
            
            local function update()
                if mob and mob.Parent and hum and hrp and ESPSettings.mobESP then
                    local char = LocalPlayer.Character
                    if char then
                        local playerHrp = char:FindFirstChild("HumanoidRootPart")
                        if playerHrp then
                            local dist = (hrp.Position - playerHrp.Position).Magnitude
                            local screenPos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
                            
                            if dist > ESPSettings.espDistance or not onScreen then
                                espText.Visible = false
                                highlight.Enabled = false
                            else
                                local healthPercent = hum.MaxHealth > 0 and hum.Health / hum.MaxHealth * 100 or 0
                                local hp = math.clamp(math.floor(healthPercent), 0, 100)
                                local name = mob.Name:match("^(.-)_") or mob.Name
                                
                                espText.Text = string.format("[%s] [Dist: %.1f] [HP: %d%%]", name, dist, hp)
                                espText.Position = Vector2.new(screenPos.X, screenPos.Y - 50)
                                espText.Size = ESPSettings.fontSize
                                espText.Visible = true
                                highlight.Enabled = true
                            end
                        end
                    else
                        return
                    end
                else
                    RunService:UnbindFromRenderStep(renderName)
                    removeMobESP(mob)
                    return
                end
            end
            
            RunService:BindToRenderStep(renderName, Enum.RenderPriority.Camera.Value + 1, update)
            
            mob.AncestryChanged:Connect(function(_, parent)
                if not parent then
                    RunService:UnbindFromRenderStep(renderName)
                    removeMobESP(mob)
                end
            end)
        end
    else
        return
    end
end

local function loadMobESP()
    for _, mob in ipairs(workspace.Entities:GetChildren()) do
        if mob:IsA("Model") and not (Players:FindFirstChild(mob.Name) or ESPSettings.ActiveMobs[mob]) then
            setupMobESP(mob)
        end
    end
end

local function loadNPCESP()
    for _, npc in ipairs(workspace.Dialogues:GetChildren()) do
        if npc:IsA("Model") and not ESPSettings.ActiveNPCs[npc] then
            setupNPCESP(npc)
        end
    end
end

workspace.Entities.ChildAdded:Connect(function(child)
    if child:IsA("Model") and not Players:FindFirstChild(child.Name) then
        setupMobESP(child)
    end
end)

ESPGroup:AddToggle("PlayerESP", {
    Text = "Player ESP",
    Default = false,
    Tooltip = "ESP players with name, distance, and health",
    Callback = function(value)
        ESPSettings.PlayerESP = value
        if ESPSettings.PlayerESP then
            PlayerESP:load()
        else
            PlayerESP:unload()
        end
    end
}):AddColorPicker("PlayerColorPicker", {
    Default = ESPSettings.MobESPColor,
    Title = "Player ESP Color",
    Transparency = 0
})

ESPGroup:AddToggle("MobESP", {
    Text = "MobESP",
    Default = false,
    Tooltip = "ESP mobs with name, distance, and health",
    Callback = function(value)
        ESPSettings.mobESP = value
        if ESPSettings.mobESP then
            loadMobESP()
        else
            for mob, _ in pairs(ESPSettings.ActiveMobs) do
                removeMobESP(mob)
            end
            ESPSettings.ESPObjects = {}
        end
    end
}):AddColorPicker("MobColorPicker", {
    Default = ESPSettings.MobESPColor,
    Title = "Mob ESP Color",
    Transparency = 0,
    Callback = function(value)
        ESPSettings.MobESPColor = value
        for _, espData in pairs(ESPSettings.ActiveMobs) do
            if espData.highlight then
                espData.highlight.FillColor = value
            end
        end
    end
})

ESPGroup:AddToggle("NPCEsp", {
    Text = "NpcESP",
    Default = false,
    Tooltip = "NPC ESP",
    Callback = function(value)
        ESPSettings.npcESP = value
        if ESPSettings.npcESP then
            loadNPCESP()
        else
            for npc, _ in pairs(ESPSettings.ActiveNPCs) do
                removeESP(npc, ESPSettings.NPCESPOBjects, ESPSettings.ActiveNPCs)
            end
            ESPSettings.NPCESPOBjects = {}
        end
    end
}):AddColorPicker("NPCEspPicker", {
    Default = ESPSettings.NpcESPColor,
    Title = "NPC ESP COLOR",
    Transparency = 0,
    Callback = function(value)
        ESPSettings.NpcESPColor = value
        for _, espData in pairs(ESPSettings.ActiveNPCs) do
            espData.espText.Color = value
        end
    end
})

ESPGroup:AddSlider("Distance", {
    Text = "ESP Distance",
    Default = 1000,
    Min = 0,
    Max = 10000,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        ESPSettings.espDistance = value
    end
})

ESPGroup:AddSlider("TextSizeSlider", {
    Text = "Text Font Size",
    Default = 14,
    Min = 10,
    Max = 30,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        ESPSettings.fontSize = value
    end
})

-- World Tab
local FarmSettings = {
    AutoFarmMobsDistance = 10,
    AutoFarmMobsHeight = 0,
    AutoFarmMobs = false,
    AutoFarmSelectedMobs = false
}

WorldGroup:AddToggle("Attach to nearby mobs", {
    Text = "Auto Farm Nearby Mobs",
    Default = false,
    Tooltip = "Auto Farm Nearest mob",
    Callback = function(value)
        FarmSettings.AutoFarmMobs = value
        if FarmSettings.AutoFarmMobs then
            task.spawn(function()
                while FarmSettings.AutoFarmMobs and task.wait() do
                    local char = LocalPlayer.Character
                    if not (char and char:FindFirstChild("HumanoidRootPart") and Character.PrimaryPart) then
                        return
                    end
                    
                    local hrp = char.HumanoidRootPart
                    local nearestDist = math.huge
                    local nearestMob = nil
                    
                    for _, mob in pairs(workspace.Entities:GetChildren()) do
                        if mob:IsA("Model") and not Players:FindFirstChild(mob.Name) then
                            local mobHrp = mob:FindFirstChild("HumanoidRootPart") or mob.PrimaryPart
                            if mobHrp then
                                local dist = (hrp.Position - mobHrp.Position).Magnitude
                                if dist < nearestDist then
                                    nearestMob = mobHrp
                                    nearestDist = dist
                                end
                            end
                        end
                    end
                    
                    if nearestMob then
                        repeat
                            tweenTo(nearestMob.CFrame * CFrame.new(0, FarmSettings.AutoFarmMobsHeight, FarmSettings.AutoFarmMobsDistance), 170)
                            task.wait()
                        until not (FarmSettings.AutoFarmMobs and nearestMob.Parent and nearestMob:IsDescendantOf(workspace)) or nearestMob.Parent:FindFirstChild("Humanoid").Health <= 0
                    end
                end
            end)
        end
    end
}):AddKeyPicker("AutoFarmNearbyKeybind", {
    Default = "",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "AutoFarmNearby Keybind",
    NoUI = false
})

WorldGroup:AddToggle("Attach to nearby Players", {
    Text = "Auto Farm Nearby Players",
    Default = false,
    Tooltip = "Auto Farm Nearest Players",
    Callback = function(value)
        FarmSettings.autofarmplayers = value
        if FarmSettings.autofarmplayers then
            task.spawn(function()
                while FarmSettings.autofarmplayers and task.wait() do
                    local char = LocalPlayer.Character
                    if not (char and char:FindFirstChild("HumanoidRootPart")) then
                        return
                    end
                    
                    local hrp = char.HumanoidRootPart
                    local nearestDist = math.huge
                    local nearestPlayer = nil
                    
                    for _, player in pairs(Players:GetPlayers()) do
                        if player ~= LocalPlayer and player.Character then
                            local playerChar = player.Character
                            local playerHrp = playerChar:FindFirstChild("HumanoidRootPart") or playerChar.PrimaryPart
                            
                            if playerHrp then
                                local dist = (hrp.Position - playerHrp.Position).Magnitude
                                if dist < nearestDist then
                                    nearestPlayer = playerHrp
                                    nearestDist = dist
                                end
                            end
                        end
                    end
                    
                    if nearestPlayer then
                        tweenTo(nearestPlayer.CFrame * CFrame.new(0, FarmSettings.AutoFarmMobsHeight, FarmSettings.AutoFarmMobsDistance), 170)
                        task.wait()
                        
                        if Settings.autofarmplayers and nearestPlayer and nearestPlayer.Parent and nearestPlayer:IsDescendantOf(workspace) and nearestPlayer.Parent:FindFirstChild("Humanoid").Health > 0 then
                            break
                        end
                    end
                end
            end)
        end
    end
}):AddKeyPicker("AutoFarmNearbyPlayersKeybind", {
    Default = "",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "AutoFarmNearby Players Keybind",
    NoUI = false
})

WorldGroup:AddSlider("Distance", {
    Text = "Distance",
    Default = 10,
    Min = 0,
    Max = 30,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        FarmSettings.AutoFarmMobsDistance = value
    end
})

WorldGroup:AddSlider("Height", {
    Text = "Height",
    Default = 0,
    Min = -30,
    Max = 30,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        FarmSettings.AutoFarmMobsHeight = value
    end
})

local bringMobConnection = nil
WorldGroup:AddToggle("Bring Mob", {
    Text = "Bring Mob",
    Default = false,
    Tooltip = "Bring Mob",
    Callback = function(value)
        Settings.bringmobs = value
        if Settings.bringmobs then
            bringMobConnection = RunService.RenderStepped:Connect(function()
                if Settings.bringmobs then
                    for _, mob in ipairs(workspace.Entities:GetChildren()) do
                        if mob:IsA("Model") and mob:FindFirstChild("HumanoidRootPart") and not game.Players:FindFirstChild(mob.Name) then
                            if getDistance(game.Players.LocalPlayer.Character.PrimaryPart.Position, mob.PrimaryPart.Position) < Settings.bringmobsrange and isnetworkowner(mob.PrimaryPart) then
                                mob:FindFirstChild("HumanoidRootPart").CFrame = LocalPlayer.Character.PrimaryPart.CFrame * CFrame.new(0, 0, -Settings.bringmobsdistance)
                            end
                        end
                    end
                end
            end)
        elseif bringMobConnection then
            bringMobConnection:Disconnect()
            bringMobConnection = nil
        end
    end
}):AddKeyPicker("BringMobKeybind", {
    Default = "",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Bring Mob Keybind",
    NoUI = false
})

WorldGroup:AddSlider("Bring Mobs Range", {
    Text = "Bring Mob Range",
    Default = 1000,
    Min = 0,
    Max = 10000,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        Settings.bringmobsrange = value
    end
})

WorldGroup:AddSlider("BringMobsDistance", {
    Text = "Bring Mob Distance",
    Default = 50,
    Min = 0,
    Max = 100,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        Settings.bringmobsdistance = value
    end
})

local killAuraConnection = nil
WorldGroup:AddToggle("Kill Aura", {
    Text = "Kill Aura",
    Default = false,
    Tooltip = "Instant Kill",
    Callback = function(value)
        Settings.VoidMob = value
        if Settings.VoidMob then
            while Settings.VoidMob and task.wait() do
                for _, mob in ipairs(workspace.Entities:GetChildren()) do
                    if mob:IsA("Model") and not game.Players:FindFirstChild(mob.Name) then
                        local hum = mob:FindFirstChild("Humanoid")
                        if hum then
                            hum.Health = 0
                            hum.MaxHealth = 0
                        end
                        
                        for _, part in ipairs(mob:GetDescendants()) do
                            if part:IsA("BasePart") then
                                part:BreakJoints()
                            end
                        end
                    end
                end
            end
        end
    end
}):AddKeyPicker("KillAuraKeybind", {
    Default = "",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Kill Aura Keybind",
    NoUI = false
})

WorldGroup:AddToggle("Kill Aura If Creds", {
    Text = "Kill Aura if Creds",
    Default = false,
    Tooltip = "Instant Kill",
    Callback = function(value)
        Settings.killauraifcreds = value
        if value then
            killAuraConnection = RunService.RenderStepped:Connect(function()
                if Settings.killauraifcreds then
                    for _, mob in ipairs(workspace.Entities:GetChildren()) do
                        if mob:IsA("Model") and not game.Players:FindFirstChild(mob.Name) and mob:FindFirstChild("Humanoid") then
                            local hum = mob:FindFirstChild("Humanoid")
                            if hum and hum.Health / hum.MaxHealth * 100 < Settings.killaurahp then
                                hum.Health = 0
                                hum.MaxHealth = 0
                            end
                        end
                    end
                end
            end)
        elseif killAuraConnection then
            killAuraConnection:Disconnect()
        end
    end
}):AddKeyPicker("KillAuraIfCredsKeybind", {
    Default = "",
    SyncToggleState = true,
    Mode = "Toggle",
    Text = "Kill Aura if Creds Keybind",
    NoUI = false
})

WorldGroup:AddSlider("Kill Aura Creds HP Threshold", {
    Text = "Kill Aura HP Threshold %",
    Default = 100,
    Min = 0,
    Max = 100,
    Rounding = 0,
    Compact = true,
    Callback = function(value)
        Settings.killaurahp = value
    end
})

WorldGroup:AddButton("Go to quest marker", function()
    if Character:FindFirstChild("MissionIcon") then
        teleportTo(Character.MissionIcon.Position.X, Character.MissionIcon.Position.Y, Character.MissionIcon.Position.Z)
    else
        warn("No Mission")
    end
    
    if Character:FindFirstChild("BoxDeliveryIcon") then
        teleportTo(Character.BoxDeliveryIcon.Position.X, Character.BoxDeliveryIcon.Position.Y, Character.BoxDeliveryIcon.Position.Z)
    else
        warn("No Box Icon")
    end
end)

WorldGroup:AddButton("Go to Event marker", function()
    if Character:FindFirstChild("EventMarker") then
        teleportTo(Character.EventMarker.Position.X, Character.EventMarker.Position.Y, Character.EventMarker.Position.Z)
    else
        warn("no event")
    end
end)

WorldGroup:AddButton("Go to Nearest Loot Crate", function()
    local nearestDist = math.huge
    local nearestCrate = nil
    
    for _, obj in pairs(workspace:GetChildren()) do
        if obj.Name == "giftbox_blend" then
            local dist = (obj.WorldPivot.Position - game.Players.LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
            if dist < nearestDist then
                nearestCrate = obj
                nearestDist = dist
            end
        end
    end
    
    if nearestCrate then
        teleportTo(nearestCrate.WorldPivot.Position.X, nearestCrate.WorldPivot.Position.Y, nearestCrate.WorldPivot.Position.Z)
    else
        warn("No giftbox_blend found in the workspace.")
    end
end)

WorldGroup:AddButton("Go to Nearest Artifact", function()
    local nearestDist = math.huge
    local nearestArtifact = nil
    
    for _, obj in pairs(workspace:GetChildren()) do
        if string.find(obj.Name, "Artifact") then
            local dist = (obj.WorldPivot.Position - game.Players.LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
            if dist < nearestDist then
                nearestArtifact = obj
                nearestDist = dist
            end
        end
    end
    
    if nearestArtifact then
        teleportTo(nearestArtifact.WorldPivot.Position.X, nearestArtifact.WorldPivot.Position.Y, nearestArtifact.WorldPivot.Position.Z)
    else
        warn("No Artifact found in the workspace.")
    end
end)

local selectedArea = nil
WorldGroup:AddDropdown("AreaDropdown", {
    Values = {
        "Anteiku",
        "Art Studio",
        "Clothing Store",
        "CCG Base",
        "Boss Arenas",
        "Ghoul Mission Board 1",
        "CCG Mission Board 1"
    },
    Default = {},
    Multi = false,
    Text = "Areas",
    Tooltip = "Select Area to tp to",
    Callback = function(value)
        selectedArea = value
    end
})

WorldGroup:AddButton("Goto Selected Area", function()
    if selectedArea == "Anteiku" then
        teleportTo(8461.96582, 20.8455334, 1682.95093)
    elseif selectedArea == "Art Studio" then
        teleportTo(8112.271, 8.47572327, -1640.54663)
    elseif selectedArea == "Clothing Store" then
        teleportTo(8026.98535, 6.97037315, 1923.37378)
    elseif selectedArea == "CCG Base" then
        teleportTo(7758.47509765625, -6.504365921020508, -654.6971435546875)
    elseif selectedArea == "Boss Arenas" then
        teleportTo(7714.3271484375, -5.3807783126831055, -984.1307373046875)
    elseif selectedArea == "Ghoul Mission Board 1" then
        teleportTo(8447.2578125, -4.508382320404053, 1730.5115966796875)
    elseif selectedArea == "CCG Mission Board 1" then
        teleportTo(7696.603515625, 23.998931884765625, -689.2974853515625)
    end
end)

-- Morphs (keeping minimal - you can add more morphs if needed)
local function stripChar(char)
    for _, clothingType in pairs({"Shirt", "Pants"}) do
        local item = char:FindFirstChild(clothingType)
        if item then
            item:Destroy()
        end
    end
    
    for _, item in ipairs(char:GetChildren()) do
        if item:IsA("Accessory") or item:IsA("MeshPart") then
            item:Destroy()
        end
    end
    
    if char:FindFirstChild("Head") then
        char.Head.Transparency = 1
        
        for _, part in ipairs(char.Head:GetDescendants()) do
            if part:IsA("Decal") or part:IsA("SpecialMesh") or part:IsA("Part") then
                part:Destroy()
            end
        end
    end
    
    for _, head in ipairs(workspace.FakeHeads:GetChildren()) do
        if string.match(head.Name, LocalPlayer.Name) then
            head:Destroy()
        end
    end
    
    char:FindFirstChild("Left Arm").Transparency = 0
    char:FindFirstChild("Right Arm").Transparency = 0
end

local function equipAccessory(assetId, char, posOffset, rotOffset, leftArm, hideArm)
    local accessory = game:GetObjects("rbxassetid://" .. tostring(assetId))[1]
    if accessory then
        local arm = char:FindFirstChild(leftArm and "Left Arm" or "Right Arm")
        if arm then
            if hideArm then
                arm.Transparency = 1
            end
            
            accessory.Parent = char
            if accessory:FindFirstChild("Handle") then
                local weld = Instance.new("Weld")
                weld.Name = leftArm and "LeftArmWeld" or "RightArmWeld"
                weld.Part0 = arm
                weld.Part1 = accessory.Handle
                
                local defaultPos, defaultRot
                if leftArm then
                    defaultPos = Vector3.new(-accessory.Handle.Size.X / 2, -accessory.Handle.Size.Y / 2, 0)
                    defaultRot = Vector3.new(0, 90, 0)
                else
                    defaultPos = Vector3.new(accessory.Handle.Size.X / 2, -accessory.Handle.Size.Y / 2, 0)
                    defaultRot = Vector3.new(0, -90, 0)
                end
                
                weld.C0 = CFrame.new(posOffset or defaultPos) * CFrame.Angles(
                    math.rad(rotOffset and rotOffset.X or defaultRot.X),
                    math.rad(rotOffset and rotOffset.Y or defaultRot.Y),
                    math.rad(rotOffset and rotOffset.Z or defaultRot.Z)
                )
                weld.Parent = accessory.Handle
            end
        end
    else
        return
    end
end

local function equipHead(assetId, char, posOffset, rotOffset)
    local head = game:GetObjects("rbxassetid://" .. tostring(assetId))[1]
    if head then
        local torso = char:FindFirstChild("UpperTorso") or char:FindFirstChild("Torso")
        if torso then
            head.Parent = char
            if head:FindFirstChild("Handle") then
                local weld = Instance.new("Weld")
                weld.Name = "HeadWeld"
                weld.Part0 = torso
                weld.Part1 = head.Handle
                weld.C0 = CFrame.new(posOffset or Vector3.new(0, torso.Size.Y / 1.15 + head.Handle.Size.Y / 2, 0)) * 
                          CFrame.Angles(math.rad(rotOffset.X), math.rad(rotOffset.Y), math.rad(rotOffset.Z))
                weld.Parent = head.Handle
            end
        end
    else
        return
    end
end

local function equipClothing(shirtId, pantsId, char)
    local function loadClothing(assetId, clothingType)
        local clothing = game:GetObjects("rbxassetid://" .. tostring(assetId))[1]
        if clothing then
            clothing.Parent = char
            clothing.Name = clothingType
        end
    end
    
    loadClothing(shirtId, "Shirt")
    loadClothing(pantsId, "Pants")
end

local function setSkinTone(char, brickColorName)
    local skinColor = BrickColor.new(brickColorName or "Light orange")
    
    for _, partName in pairs({"Torso", "UpperTorso", "Left Arm", "Right Arm", "Left Leg", "Right Leg"}) do
        local part = char:FindFirstChild(partName)
        if part then
            part.BrickColor = skinColor
        end
    end
end

VisualMiscGroup:AddDropdown("Morphs", {
    Values = {"Goku", "Naruto", "Gojo"},
    Default = {},
    Multi = false,
    Text = "Morphs",
    Tooltip = "Morphs",
    Callback = function(morph)
        if morph == "Goku" then
            setSkinTone(Character)
            stripChar(Character)
            equipHead(96778240725860, Character, Vector3.new(0, 2.3, 0), Vector3.new(0, 0, 0))
            equipClothing(18642081551, 13980707182, Character)
        elseif morph == "Naruto" then
            setSkinTone(Character, "Pastel yellow")
            stripChar(Character)
            equipHead(129818847988995, Character, Vector3.new(0, 1.8, 0), Vector3.new(0, -90, 0))
            equipClothing(6469644436, 2733834231, Character)
        elseif morph == "Gojo" then
            setSkinTone(Character)
            stripChar(Character)
            equipHead(132501783778842, Character, Vector3.new(0, 1.9, 0), Vector3.new(0, 0, 0))
            equipClothing(73084050138865, 15312673306, Character)
        end
    end
})

VisualMiscGroup:AddToggle("StreamerMode", {
    Text = "Streamer Mode",
    Default = false,
    Tooltip = "Hides your UID",
    Callback = function(value)
        game:GetService("Players").LocalPlayer.PlayerGui.ClientInfo.Section1.Visible = not value
    end
})

local atmosphereDensity = 0.44999998807907104
VisualMiscGroup:AddToggle("NoFog", {
    Text = "No Fog",
    Default = false,
    Tooltip = "Removes Fog",
    Callback = function(value)
        if value then
            if Lighting:FindFirstChild("Atmosphere") then
                Lighting.Atmosphere.Density = 0
            end
        elseif Lighting:FindFirstChild("Atmosphere") then
            Lighting.Atmosphere.Density = atmosphereDensity
        end
    end
})

local weatherConnection = nil
VisualMiscGroup:AddToggle("No Weather", {
    Text = "No Weather",
    Default = false,
    Tooltip = "Removes Weather",
    Callback = function(value)
        if not weatherConnection then
            weatherConnection = nil
        end
        
        if value then
            for _, obj in ipairs(workspace.DebrisFolder:GetChildren()) do
                if string.find(obj.Name, "Weather") then
                    obj:Destroy()
                end
            end
            
            weatherConnection = workspace.DebrisFolder.DescendantAdded:Connect(function(obj)
                if string.find(obj.Name, "Weather") then
                    obj:Destroy()
                end
            end)
        elseif weatherConnection then
            weatherConnection:Disconnect()
            weatherConnection = nil
        end
    end
})

local fullbrightConnection = nil
VisualMiscGroup:AddToggle("FullBright", {
    Text = "FullBright",
    Default = false,
    Tooltip = "Turns off darkness and shadows",
    Callback = function(value)
        Settings.fullbright = value
        
        if fullbrightConnection then
            fullbrightConnection:Disconnect()
            fullbrightConnection = nil
        end
        
        if value then
            fullbrightConnection = RunService.RenderStepped:Connect(function()
                game.Lighting.Brightness = Settings.Brightness or 2
                game.Lighting.ClockTime = 14
                game.Lighting.FogEnd = 100000
                game.Lighting.GlobalShadows = false
                game.Lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
            end)
        else
            game.Lighting.Brightness = 1
            game.Lighting.ClockTime = 14
            game.Lighting.FogEnd = 1000000
            game.Lighting.GlobalShadows = true
            game.Lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
        end
    end
})

VisualMiscGroup:AddSlider("Brightness", {
    Text = "Brightness",
    Default = 2,
    Min = 0,
    Max = 10,
    Rounding = 1,
    Callback = function(value)
        Settings.Brightness = value
    end
})

-- Misc Tab
MiscGroup:AddButton("Serverhop", function()
    serverHop()
end)

MiscGroup:AddInput("JobID", {
    Default = "",
    Numeric = false,
    Finished = false,
    Text = "JobID",
    Tooltip = "Job ID",
    Placeholder = ""
})

MiscGroup:AddButton({
    Text = "Join Server",
    Func = function()
        game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, Options.JobID.Value, Players.LocalPlayer)
    end,
    Tooltip = "Join Server, Add the JobId on the textbox or uses the latest clipboard if empty"
})

MiscGroup:AddButton("Teleport to Permadeath Server", function()
    game:GetService("Players").LocalPlayer.PlayerGui:FindFirstChild("ServerListUI").Enabled = true
    task.wait(0.1)
    
    local found = false
    for _, button in ipairs(game:GetService("Players").LocalPlayer.PlayerGui:FindFirstChild("ServerListUI").Container.CosmeticInterface.ScrollingFrame:GetChildren()) do
        if button:IsA("TextButton") and string.find(button.ServerName.Text, "PERMADEATH") then
            local current, max = string.match(button.ServerSize.Text, "(%d+)%s*/%s*(%d+)")
            
            if current and max and tonumber(current) < tonumber(max) then
                GuiService.SelectedObject = button
                task.wait(0.1)
                VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
                task.wait(0)
                VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
                task.wait(0.1)
                button.Active = false
                GuiService.SelectedObject = nil
                found = true
                break
            end
        end
    end
    
    if not found then
        Library:Notify("No permadeath server found", 10)
    end
    
    task.wait(0.1)
    game:GetService("Players").LocalPlayer.PlayerGui:FindFirstChild("ServerListUI").Enabled = false
end)

MiscGroup:AddToggle("ModNotifier", {
    Text = "Mod Notifier",
    Default = false,
    Tooltip = "Notifies if a Moderator joined",
    Callback = function(value)
        Settings.ModNotifer = value
    end
})

MiscGroup:AddToggle("KickIfMod", {
    Text = "Kick if Mod joined",
    Default = false,
    Tooltip = "Kick yourself when a moderator joined the server",
    Callback = function(value)
        Settings.kickifmod = value
    end
})

game.Players.PlayerAdded:Connect(function(player)
    if Settings.ModNotifer and player:GetRankInGroup(34160477) > 1 then
        Library:Notify("A Moderator has joined: " .. player.Name, 20)
    end
    
    if Settings.kickifmod and player:GetRankInGroup(34160477) > 1 then
        LocalPlayer:Kick("A Moderator has joined: " .. player.Name)
    end
end)

-- Spectate Players
local function spectatePlayer(player)
    local char = player.Character
    if char and char:FindFirstChild("Humanoid") then
        workspace.CurrentCamera.CameraSubject = char.Humanoid
    end
end

local function stopSpectate()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("Humanoid") then
        workspace.CurrentCamera.CameraSubject = char.Humanoid
    end
end

local function setupSpectateButton(button)
    local player = Players:FindFirstChild(button.Name)
    
    button.MouseButton1Down:Connect(function()
        if Settings.spectateplayers and player then
            spectatePlayer(player)
        end
    end)
    
    button.MouseButton1Up:Connect(function()
        if Settings.spectateplayers then
            stopSpectate()
        end
    end)
    
    button.MouseLeave:Connect(function()
        if Settings.spectateplayers then
            stopSpectate()
        end
    end)
end

local function setupAllSpectateButtons()
    for _, button in ipairs(game:GetService("Players").LocalPlayer.PlayerGui.Leaderboard.Leaderboard:GetChildren()) do
        if button:IsA("ImageButton") then
            setupSpectateButton(button)
        end
    end
end

local function removeAllSpectateButtons()
    for _, button in ipairs(game:GetService("Players").LocalPlayer.PlayerGui.Leaderboard.Leaderboard:GetChildren()) do
        if button:IsA("ImageButton") then
            button.MouseButton1Down:Disconnect()
            button.MouseButton1Up:Disconnect()
            button.MouseLeave:Disconnect()
        end
    end
end

game:GetService("Players").LocalPlayer.PlayerGui.Leaderboard.Leaderboard.ChildAdded:Connect(function(child)
    if child:IsA("ImageButton") then
        setupSpectateButton(child)
    end
end)

MiscGroup:AddToggle("SpectatePlayer", {
    Text = "Spectate Players",
    Default = false,
    Tooltip = "Hold down the username from the leaderboard",
    Callback = function(value)
        Settings.spectateplayers = value
        if Settings.spectateplayers then
            setupAllSpectateButtons()
        else
            removeAllSpectateButtons()
            stopSpectate()
        end
    end
})

MiscGroup:AddToggle("FPS Unlockers", {
    Text = "FPS Unlocker",
    Default = false,
    Tooltip = "FPS Unlocker",
    Callback = function(value)
        Settings.fpsunlocker = value
        if not Settings.fpsunlocker then
            setfpscap(120)
        end
    end
})

MiscGroup:AddInput("FPS", {
    Default = 120,
    Numeric = true,
    Finished = true,
    Text = "FPS",
    Tooltip = "FPS",
    Placeholder = "",
    Callback = function(value)
        if Settings.fpsunlocker then
            setfpscap(tonumber(value))
        end
    end
})

Library:OnUnload(function()
    print("Unloaded!")
    Library.Unloaded = true
end)

-- Watermark
local lastTime = tick()
local frameCount = 0
local currentFps = 60

local fpsConnection = RunService.RenderStepped:Connect(function()
    frameCount = frameCount + 1
    
    if tick() - lastTime >= 1 then
        currentFps = frameCount
        local newTime = tick()
        frameCount = 0
        lastTime = newTime
    end
    
    Library:SetWatermark(("XES Hub | %s fps | %s ms"):format(
        math.floor(currentFps),
        math.floor(game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue())
    ))
end)

Library:OnUnload(function()
    fpsConnection:Disconnect()
    print("Unloaded!")
    Library.Unloaded = true
end)

-- UI Settings
local MenuGroup = Tabs["UI Settings"]:AddLeftGroupbox("Menu")

MenuGroup:AddButton("Unload", function()
    Library:Unload()
end)

MenuGroup:AddLabel("Menu bind"):AddKeyPicker("MenuKeybind", {
    Default = "End",
    NoUI = true,
    Text = "Menu keybind"
})

Library.ToggleKeybind = Options.MenuKeybind

MenuGroup:AddToggle("KeybindPanel", {
    Text = "Keybinds Menu",
    Default = true,
    Callback = function(value)
        Library.KeybindFrame.Visible = value
    end
})

ThemeManager:SetLibrary(Library)
SaveManager:SetLibrary(Library)
SaveManager:IgnoreThemeSettings()

ThemeManager:SetFolder("XESHub")
SaveManager:SetFolder("XESHub/specific-game")

SaveManager:BuildConfigSection(Tabs["UI Settings"])
ThemeManager:ApplyToTab(Tabs["UI Settings"])

SaveManager:LoadAutoloadConfig()
