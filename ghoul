--[[ 
    Xes Hub - ABA Script
    UI: Rayfield
    Complete Version with Farm Overlay + Gold Farm + Exploits
    FIXES: Auto M1, Rematch Spam, Ban Skipping
]] 

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualUser = game:GetService("VirtualUser")
local LocalPlayer = Players.LocalPlayer
local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Debris = game:GetService("Debris")
local VirtualInputManager = game:GetService("VirtualInputManager")

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local isAltAccount = false
local isMainAccount = false
local desyncEnabled = false
local desyncActive = false
local Connections = {}
local webhookUrl = ""
local autoSkipBansEnabled = true

-- Farm Statistics
local FarmStats = {
    StartTime = 0,
    StartLevel = 0,
    StartMoney = 0,
    CurrentLevel = 0,
    CurrentMoney = 0,
    LevelsGained = 0,
    MoneyGained = 0
}

-- Anti-AFK
LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

-- Auto Rematch - FIXED: Always active, ultra aggressive continuous spamming
task.spawn(function()
    while task.wait(0.1) do -- Very fast spamming every 0.1 seconds
        pcall(function()
            -- Try multiple possible rematch remote names
            local rematchEvent = ReplicatedStorage:FindFirstChild("RematchVote")
            if rematchEvent then
                rematchEvent:FireServer()
            end
            
            local rematch = ReplicatedStorage:FindFirstChild("Rematch")
            if rematch then
                rematch:FireServer()
            end
            
            local voteRematch = ReplicatedStorage:FindFirstChild("VoteRematch")
            if voteRematch then
                voteRematch:FireServer()
            end
        end)
    end
end)

local function GetPlayerLevel()
    local success, level = pcall(function()
        local hudGui = LocalPlayer.PlayerGui:FindFirstChild("HUD")
        if not hudGui then return 0 end
        
        local lvlLabel = hudGui:FindFirstChild("Lvl")
        if not lvlLabel or not lvlLabel.Text then return 0 end
        
        -- Extract number from text like "Lvl 25" or "25"
        local levelNum = lvlLabel.Text:match("%d+")
        return tonumber(levelNum) or 0
    end)
    
    if success then
        return level
    else
        return 0
    end
end

local function GetPlayerMoney()
    local success, money = pcall(function()
        -- Try multiple possible paths for the money UI element
        local hudGui = LocalPlayer.PlayerGui:FindFirstChild("HUD")
        if not hudGui then return 0 end
        
        -- Try Money.Money.Text path
        local moneyFrame = hudGui:FindFirstChild("Money")
        if moneyFrame then
            local moneyLabel = moneyFrame:FindFirstChild("Money")
            if moneyLabel and moneyLabel.Text then
                local cleanText = moneyLabel.Text:gsub(",", ""):gsub("%$", ""):gsub("%s", "")
                return tonumber(cleanText) or 0
            end
        end
        
        -- Try direct Money text path
        if moneyFrame and moneyFrame.Text then
            local cleanText = moneyFrame.Text:gsub(",", ""):gsub("%$", ""):gsub("%s", "")
            return tonumber(cleanText) or 0
        end
        
        return 0
    end)
    
    if success then
        return money
    else
        return 0
    end
end

local function FormatTime(seconds)
    local hours = math.floor(seconds / 3600)
    local minutes = math.floor((seconds % 3600) / 60)
    local secs = math.floor(seconds % 60)
    
    if hours > 0 then
        return string.format("%dh %dm", hours, minutes)
    elseif minutes > 0 then
        return string.format("%dm %ds", minutes, secs)
    else
        return string.format("%ds", secs)
    end
end

local function FormatNumber(num)
    if num >= 1000000 then
        return string.format("%.1fM", num / 1000000)
    elseif num >= 1000 then
        return string.format("%.1fK", num / 1000)
    else
        return tostring(num)
    end
end

local function SendWebhook(title, description, color)
    if webhookUrl == "" or webhookUrl == "YOUR_WEBHOOK_URL_HERE" then return end
    
    local data = {
        ["embeds"] = {{
            ["title"] = title,
            ["description"] = description,
            ["color"] = color,
            ["footer"] = {
                ["text"] = os.date("%I:%M %p")
            }
        }}
    }
    
    pcall(function()
        local jsonData = HttpService:JSONEncode(data)
        request({
            Url = webhookUrl,
            Method = "POST",
            Headers = {
                ["Content-Type"] = "application/json"
            },
            Body = jsonData
        })
    end)
end

local function SendFarmWebhook()
    if webhookUrl == "" or webhookUrl == "YOUR_WEBHOOK_URL_HERE" then return end
    
    local runtime = os.time() - FarmStats.StartTime
    local accountType = isMainAccount and "main" or "alt"
    
    local description = string.format(
        "%s | %s\n\n" ..
        "lvl %d -> %d (+%d)\n" ..
        "$%s -> $%s (+$%s)\n\n" ..
        "uptime: %s",
        LocalPlayer.Name,
        accountType,
        FarmStats.StartLevel,
        FarmStats.CurrentLevel,
        FarmStats.LevelsGained,
        FormatNumber(FarmStats.StartMoney),
        FormatNumber(FarmStats.CurrentMoney),
        FormatNumber(FarmStats.MoneyGained),
        FormatTime(runtime)
    )
    
    SendWebhook("farm update", description, 3447003)
end

-- Create Farm Overlay UI
local FarmOverlay = nil

local function CreateFarmOverlay()
    if FarmOverlay then return end
    
    -- Create ScreenGui that covers EVERYTHING
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "XesFarmOverlay"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.DisplayOrder = 999999999
    ScreenGui.IgnoreGuiInset = true
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- Black background that covers entire screen
    local Background = Instance.new("Frame")
    Background.Name = "Background"
    Background.Size = UDim2.new(1, 0, 1, 0)
    Background.Position = UDim2.new(0, 0, 0, 0)
    Background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    Background.BorderSizePixel = 0
    Background.ZIndex = 999999999
    Background.Parent = ScreenGui
    
    -- Stats display
    local StatsFrame = Instance.new("Frame")
    StatsFrame.Name = "StatsFrame"
    StatsFrame.Size = UDim2.new(0, 320, 0, 200)
    StatsFrame.Position = UDim2.new(0.5, -160, 0.5, -100)
    StatsFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
    StatsFrame.BorderColor3 = Color3.fromRGB(40, 40, 40)
    StatsFrame.BorderSizePixel = 1
    StatsFrame.ZIndex = 1000000000
    StatsFrame.Parent = Background
    
    -- Username
    local Username = Instance.new("TextLabel")
    Username.Name = "Username"
    Username.Size = UDim2.new(1, -20, 0, 25)
    Username.Position = UDim2.new(0, 10, 0, 10)
    Username.BackgroundTransparency = 1
    Username.Text = LocalPlayer.Name
    Username.TextColor3 = Color3.fromRGB(180, 180, 180)
    Username.TextSize = 15
    Username.Font = Enum.Font.Code
    Username.TextXAlignment = Enum.TextXAlignment.Left
    Username.ZIndex = 1000000001
    Username.Parent = StatsFrame
    
    -- Mode indicator
    local Mode = Instance.new("TextLabel")
    Mode.Name = "Mode"
    Mode.Size = UDim2.new(1, -20, 0, 20)
    Mode.Position = UDim2.new(0, 10, 0, 35)
    Mode.BackgroundTransparency = 1
    Mode.Text = (isMainAccount and "main" or "alt")
    Mode.TextColor3 = Color3.fromRGB(120, 120, 120)
    Mode.TextSize = 13
    Mode.Font = Enum.Font.Code
    Mode.TextXAlignment = Enum.TextXAlignment.Left
    Mode.ZIndex = 1000000001
    Mode.Parent = StatsFrame
    
    -- Runtime
    local Runtime = Instance.new("TextLabel")
    Runtime.Name = "Runtime"
    Runtime.Size = UDim2.new(1, -20, 0, 22)
    Runtime.Position = UDim2.new(0, 10, 0, 70)
    Runtime.BackgroundTransparency = 1
    Runtime.Text = "0s"
    Runtime.TextColor3 = Color3.fromRGB(200, 200, 200)
    Runtime.TextSize = 16
    Runtime.Font = Enum.Font.Code
    Runtime.TextXAlignment = Enum.TextXAlignment.Left
    Runtime.ZIndex = 1000000001
    Runtime.Parent = StatsFrame
    
    -- Level display
    local LevelDisplay = Instance.new("TextLabel")
    LevelDisplay.Name = "LevelDisplay"
    LevelDisplay.Size = UDim2.new(1, -20, 0, 22)
    LevelDisplay.Position = UDim2.new(0, 10, 0, 105)
    LevelDisplay.BackgroundTransparency = 1
    LevelDisplay.Text = "lvl 0 -> 0 (+0)"
    LevelDisplay.TextColor3 = Color3.fromRGB(100, 255, 100)
    LevelDisplay.TextSize = 16
    LevelDisplay.Font = Enum.Font.Code
    LevelDisplay.TextXAlignment = Enum.TextXAlignment.Left
    LevelDisplay.ZIndex = 1000000001
    LevelDisplay.Parent = StatsFrame
    
    -- Money display
    local MoneyDisplay = Instance.new("TextLabel")
    MoneyDisplay.Name = "MoneyDisplay"
    MoneyDisplay.Size = UDim2.new(1, -20, 0, 22)
    MoneyDisplay.Position = UDim2.new(0, 10, 0, 135)
    MoneyDisplay.BackgroundTransparency = 1
    MoneyDisplay.Text = "$0 -> $0 (+$0)"
    MoneyDisplay.TextColor3 = Color3.fromRGB(255, 200, 50)
    MoneyDisplay.TextSize = 16
    MoneyDisplay.Font = Enum.Font.Code
    MoneyDisplay.TextXAlignment = Enum.TextXAlignment.Left
    MoneyDisplay.ZIndex = 1000000001
    MoneyDisplay.Parent = StatsFrame
    
    -- Bottom info
    local BottomInfo = Instance.new("TextLabel")
    BottomInfo.Name = "BottomInfo"
    BottomInfo.Size = UDim2.new(1, -20, 0, 18)
    BottomInfo.Position = UDim2.new(0, 10, 1, -28)
    BottomInfo.BackgroundTransparency = 1
    BottomInfo.Text = "webhook: 5min intervals"
    BottomInfo.TextColor3 = Color3.fromRGB(80, 80, 80)
    BottomInfo.TextSize = 11
    BottomInfo.Font = Enum.Font.Code
    BottomInfo.TextXAlignment = Enum.TextXAlignment.Center
    BottomInfo.ZIndex = 1000000001
    BottomInfo.Parent = StatsFrame
    
    ScreenGui.Parent = LocalPlayer.PlayerGui
    FarmOverlay = ScreenGui
    
    return ScreenGui
end

local function UpdateFarmOverlay()
    if not FarmOverlay then return end
    
    local runtime = os.time() - FarmStats.StartTime
    FarmStats.CurrentLevel = GetPlayerLevel()
    FarmStats.CurrentMoney = GetPlayerMoney()
    FarmStats.LevelsGained = FarmStats.CurrentLevel - FarmStats.StartLevel
    FarmStats.MoneyGained = FarmStats.CurrentMoney - FarmStats.StartMoney
    
    local StatsFrame = FarmOverlay.Background.StatsFrame
    
    StatsFrame.Runtime.Text = FormatTime(runtime)
    StatsFrame.LevelDisplay.Text = string.format("lvl %d -> %d (+%d)", 
        FarmStats.StartLevel, FarmStats.CurrentLevel, FarmStats.LevelsGained)
    StatsFrame.MoneyDisplay.Text = string.format("$%s -> $%s (+$%s)", 
        FormatNumber(FarmStats.StartMoney), FormatNumber(FarmStats.CurrentMoney), FormatNumber(FarmStats.MoneyGained))
end

local function RemoveFarmOverlay()
    if FarmOverlay then
        FarmOverlay:Destroy()
        FarmOverlay = nil
    end
end

local function StartFarming()
    FarmStats.StartTime = os.time()
    FarmStats.StartLevel = GetPlayerLevel()
    FarmStats.StartMoney = GetPlayerMoney()
    FarmStats.CurrentLevel = FarmStats.StartLevel
    FarmStats.CurrentMoney = FarmStats.StartMoney
    FarmStats.LevelsGained = 0
    FarmStats.MoneyGained = 0
    
    CreateFarmOverlay()
    
    -- Update overlay every second
    if Connections['OverlayUpdate'] then
        Connections['OverlayUpdate']:Disconnect()
    end
    Connections['OverlayUpdate'] = RunService.RenderStepped:Connect(function()
        if isAltAccount or isMainAccount then
            UpdateFarmOverlay()
        end
    end)
    
    -- Send webhook every 5 minutes
    if Connections['WebhookTimer'] then
        Connections['WebhookTimer']:Disconnect()
    end
    Connections['WebhookTimer'] = task.spawn(function()
        while isAltAccount or isMainAccount do
            task.wait(300) -- 5 minutes
            SendFarmWebhook()
        end
    end)
    
    -- Send initial webhook
    local accountType = isMainAccount and "main" or "alt"
    SendWebhook(
        "started",
        string.format("%s | %s\n\nrunning", LocalPlayer.Name, accountType),
        65280
    )
end

local function StopFarming()
    RemoveFarmOverlay()
    
    if Connections['OverlayUpdate'] then
        Connections['OverlayUpdate']:Disconnect()
        Connections['OverlayUpdate'] = nil
    end
    
    if Connections['WebhookTimer'] then
        pcall(function() task.cancel(Connections['WebhookTimer']) end)
        Connections['WebhookTimer'] = nil
    end
    
    -- Send final webhook
    SendFarmWebhook()
    
    local accountType = isMainAccount and "main" or "alt"
    SendWebhook(
        "stopped",
        string.format("%s | %s\n\nstopped", LocalPlayer.Name, accountType),
        16711680
    )
end

local function EnableDesync()
    if desyncActive then return end
    local success = pcall(function() setfflag("NextGenReplicatorEnabledWrite4", "True") end)
    if success then
        task.wait(0.1)
        local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then humanoid:ChangeState(Enum.HumanoidStateType.Dead) end
        
        if Connections['DesyncRespawn'] then Connections['DesyncRespawn']:Disconnect() end
        Connections['DesyncRespawn'] = LocalPlayer.CharacterAdded:Connect(function(newCharacter)
            if not desyncEnabled then
                if Connections['DesyncRespawn'] then
                    Connections['DesyncRespawn']:Disconnect()
                    Connections['DesyncRespawn'] = nil
                end
                return
            end
            task.wait(0.5)
            pcall(function() setfflag("NextGenReplicatorEnabledWrite4", "False") end)
            task.wait(0.1)
            pcall(function() setfflag("NextGenReplicatorEnabledWrite4", "True") end)
            desyncActive = true
        end)
    else
        desyncEnabled = false
        return false
    end
    return true
end

local function DisableDesync()
    desyncEnabled, desyncActive = false, false
    if Connections['DesyncRespawn'] then
        Connections['DesyncRespawn']:Disconnect()
        Connections['DesyncRespawn'] = nil
    end
    pcall(function() setfflag("NextGenReplicatorEnabledWrite4", "False") end)
    
    -- Only reset character if gold farm is not active
    if not goldFarmEnabled then
        task.wait(0.1)
        local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildWhichIsA("Humanoid")
        if humanoid then
            humanoid:ChangeState(Enum.HumanoidStateType.Dead)
        end
    end
end

local function ResetCharacter()
    local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildWhichIsA("Humanoid")
    if humanoid then
        humanoid:ChangeState(Enum.HumanoidStateType.Dead)
    end
end

-- Auto Skip Bans Function - FIXED: More aggressive checking
local function SetupAutoSkipBans()
    task.spawn(function()
        task.wait(2)
        local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
        
        if Connections['AutoSkipBans'] then
            Connections['AutoSkipBans']:Disconnect()
        end
        
        -- ChildAdded connection
        Connections['AutoSkipBans'] = PlayerGui.ChildAdded:Connect(function(Child)
            if not autoSkipBansEnabled then return end
            
            task.wait(0.1)
            
            pcall(function()
                if Child.Name == 'BanChooser' then
                    local RemoteEvent = Child:FindFirstChild('Communicate', true)
                    if RemoteEvent then
                        RemoteEvent:FireServer('pass')
                        print("[xes] auto-skipped character ban")
                    end
                elseif Child.Name == 'MapBan' then
                    task.wait(.5)
                    for _, v in pairs(Child.Frame.Maps:GetChildren()) do
                        if v:FindFirstChild('Title') then
                            local MapBanner = ReplicatedStorage:FindFirstChild("MapBanner")
                            if MapBanner then
                                MapBanner:FireServer(v.Title.Text)
                                print("[xes] auto-skipped map ban")
                            end
                            break
                        end
                    end
                end
            end)
        end)
        
        -- Additional continuous check every 0.5 seconds
        task.spawn(function()
            while task.wait(0.5) do
                if not autoSkipBansEnabled then continue end
                
                pcall(function()
                    -- Check for BanChooser
                    local banChooser = PlayerGui:FindFirstChild('BanChooser')
                    if banChooser then
                        local RemoteEvent = banChooser:FindFirstChild('Communicate', true)
                        if RemoteEvent then
                            RemoteEvent:FireServer('pass')
                            print("[xes] auto-skipped character ban (continuous check)")
                        end
                    end
                    
                    -- Check for MapBan
                    local mapBan = PlayerGui:FindFirstChild('MapBan')
                    if mapBan then
                        task.wait(0.5)
                        for _, v in pairs(mapBan.Frame.Maps:GetChildren()) do
                            if v:FindFirstChild('Title') then
                                local MapBanner = ReplicatedStorage:FindFirstChild("MapBanner")
                                if MapBanner then
                                    MapBanner:FireServer(v.Title.Text)
                                    print("[xes] auto-skipped map ban (continuous check)")
                                end
                                break
                            end
                        end
                    end
                end)
            end
        end)
    end)
end

print("[xes] loaded")

local Window = Rayfield:CreateWindow({
    Name = "xes",
    LoadingTitle = "xes",
    LoadingSubtitle = "init",
    Theme = "Light",
    ConfigurationSaving = {
        Enabled = false,
        FolderName = nil,
        FileName = "xes"
    },
    Discord = {
        Enabled = false,
        Invite = "",
        RememberJoins = false
    },
    KeySystem = false
})

local MainTab = Window:CreateTab("ranked farm", 4483362458)

local FarmSection = MainTab:CreateSection("modes")

local AltToggle = MainTab:CreateToggle({
    Name = "alt mode",
    CurrentValue = false,
    Flag = "Alt",
    Callback = function(Value)
        isAltAccount = Value
        isMainAccount = false
        
        if Value then
            StartFarming()
            
            -- Start alt mode reset loop
            if not Connections['AltReset'] then
                Connections['AltReset'] = task.spawn(function()
                    while isAltAccount do
                        task.wait(1)
                        pcall(ResetCharacter)
                    end
                end)
            end
        else
            StopFarming()
            
            -- Stop alt mode reset loop
            if Connections['AltReset'] then
                pcall(function() task.cancel(Connections['AltReset']) end)
                Connections['AltReset'] = nil
            end
        end
    end,
})

local MainToggle = MainTab:CreateToggle({
    Name = "main mode",
    CurrentValue = false,
    Flag = "Main",
    Callback = function(Value)
        isMainAccount = Value
        isAltAccount = false
        
        if Value then
            StartFarming()
        else
            StopFarming()
        end
    end,
})

local DesyncSection = MainTab:CreateSection("network")

local DesyncToggle = MainTab:CreateToggle({
    Name = "desync",
    CurrentValue = false,
    Flag = "Desync",
    Callback = function(Value)
        desyncEnabled = Value
        if Value then
            EnableDesync()
        else
            DisableDesync()
        end
    end,
})

local SettingsTab = Window:CreateTab("config", 4483362458)

local RenderSection = SettingsTab:CreateSection("performance")

local Render3DToggle = SettingsTab:CreateToggle({
    Name = "disable 3d render",
    CurrentValue = false,
    Flag = "Render3D",
    Callback = function(Value)
        if Value then
            RunService:Set3dRenderingEnabled(false)
            print("[xes] 3d rendering off")
        else
            RunService:Set3dRenderingEnabled(true)
            print("[xes] 3d rendering on")
        end
    end,
})

local WebhookSection = SettingsTab:CreateSection("webhook")

local WebhookInput = SettingsTab:CreateInput({
    Name = "url",
    PlaceholderText = "discord webhook",
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        webhookUrl = Text
        
        if Text ~= "" and Text ~= "YOUR_WEBHOOK_URL_HERE" then
            SendWebhook(
                "connected",
                string.format("%s\n\nconnected", LocalPlayer.Name),
                5814783
            )
        end
    end,
})

local WebhookTest = SettingsTab:CreateButton({
    Name = "test",
    Callback = function()
        if webhookUrl == "" or webhookUrl == "YOUR_WEBHOOK_URL_HERE" then
            print("[xes] no webhook set")
        else
            SendWebhook("test", "working", 3066993)
        end
    end,
})

local InfoSection = SettingsTab:CreateSection("status")
local InfoLabel = SettingsTab:CreateLabel("afk bypass: active")
local InfoLabel2 = SettingsTab:CreateLabel("auto rematch: active")
local InfoLabel3 = SettingsTab:CreateLabel("auto skip bans: active")

local DebugSection = SettingsTab:CreateSection("debug")

local DebugButton = SettingsTab:CreateButton({
    Name = "print ui structure",
    Callback = function()
        pcall(function()
            local hudGui = LocalPlayer.PlayerGui:FindFirstChild("HUD")
            if hudGui then
                print("[xes] HUD found!")
                print("[xes] HUD children:")
                for _, child in pairs(hudGui:GetChildren()) do
                    print("  - " .. child.Name .. " (" .. child.ClassName .. ")")
                    if child:IsA("Frame") or child:IsA("TextLabel") then
                        for _, subchild in pairs(child:GetChildren()) do
                            print("    - " .. subchild.Name .. " (" .. subchild.ClassName .. ")")
                            if subchild:IsA("TextLabel") and subchild.Text then
                                print("      Text: " .. subchild.Text)
                            end
                        end
                        if child:IsA("TextLabel") and child.Text then
                            print("    Text: " .. child.Text)
                        end
                    end
                end
                
                local currentLevel = GetPlayerLevel()
                local currentMoney = GetPlayerMoney()
                print("[xes] Current Level: " .. currentLevel)
                print("[xes] Current Money: " .. currentMoney)
            else
                print("[xes] HUD not found!")
            end
        end)
    end,
})

local SkipBansSection = SettingsTab:CreateSection("auto features")

local AutoSkipBansToggle = SettingsTab:CreateToggle({
    Name = "skip bans",
    CurrentValue = true,
    Flag = "SkipBans",
    Callback = function(Value)
        autoSkipBansEnabled = Value
    end,
})

-- Gold Farm Tab
local GoldFarmTab = Window:CreateTab("gold farm", 4483362458)

local FarmWarningSection = GoldFarmTab:CreateSection("warning")
local FarmWarningLabel = GoldFarmTab:CreateLabel("enable desync first!")

local TargetSection = GoldFarmTab:CreateSection("target selection")

-- Variables for Gold Farm
local goldFarmEnabled = false
local lockOnEnabled = false
local autoAttackEnabled = false
local autoGEnabled = false
local selectedTarget = "Nearest Player"
local farmDistance = 6
local heightOffset = 2

-- Auto Skills
local autoSkill1 = false
local autoSkill2 = false
local autoSkill3 = false
local autoSkill4 = false

local skill1Distance = 50
local skill2Distance = 50
local skill3Distance = 50
local skill4Distance = 50

-- Helper Functions
local function getPlayerDistance(player1, player2)
    if not (player1 and player1.Character and player1.Character:FindFirstChild("HumanoidRootPart")) then
        return math.huge
    end
    if not (player2 and player2.Character and player2.Character:FindFirstChild("HumanoidRootPart")) then
        return math.huge
    end
    
    return (player1.Character.HumanoidRootPart.Position - player2.Character.HumanoidRootPart.Position).Magnitude
end

local function getNearestPlayer()
    local nearestPlayer = nil
    local shortestDistance = math.huge
    
    for _, player in pairs(Players:GetPlayers()) do
        if player == LocalPlayer then continue end
        if not player.Character then continue end
        if not player.Character:FindFirstChild("Humanoid") then continue end
        if player.Character.Humanoid.Health <= 0 then continue end
        if not player.Character:FindFirstChild("HumanoidRootPart") then continue end
        
        -- Skip teammates if applicable
        if player.Team == LocalPlayer.Team and LocalPlayer.Team ~= nil then continue end
        
        local distance = getPlayerDistance(LocalPlayer, player)
        if distance < shortestDistance then
            nearestPlayer = player
            shortestDistance = distance
        end
    end
    
    return nearestPlayer
end

local function getTargetPlayer()
    if selectedTarget == "Nearest Player" then
        return getNearestPlayer()
    else
        -- Find specific player by name
        for _, player in pairs(Players:GetPlayers()) do
            if player.Name == selectedTarget then
                if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    if player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 then
                        return player
                    end
                end
            end
        end
    end
    return nil
end

local function moveToTarget(target)
    if not (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")) then
        return
    end
    if not (target.Character and target.Character:FindFirstChild("HumanoidRootPart")) then
        return
    end
    
    local targetPos = target.Character.HumanoidRootPart.CFrame
    LocalPlayer.Character.HumanoidRootPart.CFrame = targetPos * CFrame.new(0, heightOffset, farmDistance)
end

local function lookAtTarget(target)
    if not (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")) then
        return
    end
    if not (target.Character and target.Character:FindFirstChild("HumanoidRootPart")) then
        return
    end
    
    local Camera = workspace.CurrentCamera
    local targetPos = target.Character.HumanoidRootPart.Position
    Camera.CFrame = CFrame.lookAt(Camera.CFrame.Position, targetPos)
end

-- FIXED: Auto Attack now uses proper remote instead of mouse1press
local function attackTarget()
    pcall(function()
        if LocalPlayer.Character then
            local mouseHitCFrame = workspace.CurrentCamera.CFrame
            if LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                mouseHitCFrame = LocalPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, -3)
            end
            
            local args = {
                "truem1",
                {
                    md = Vector3.zero,
                    skeyreal = false,
                    skeydown = true,
                    mousehit = mouseHitCFrame,
                    dodgevelo = Vector3.zero,
                    air = false
                }
            }
            
            local ServerTraits = LocalPlayer:WaitForChild("Backpack"):FindFirstChild("ServerTraits")
            if ServerTraits then
                local Input = ServerTraits:FindFirstChild("Input")
                if Input then
                    Input:FireServer(unpack(args))
                end
            end
        end
    end)
end

local function spamG()
    pcall(function()
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.G, false, game)
        task.wait(0.05)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.G, false, game)
    end)
end

local function useSkill(skillNumber)
    local keyMap = {
        [1] = "One",
        [2] = "Two",
        [3] = "Three",
        [4] = "Four"
    }
    
    local key = keyMap[skillNumber]
    if key then
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode[key], false, game)
        task.wait(0.1)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode[key], false, game)
    end
end

-- Build player list
local playerList = {"Nearest Player"}
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        table.insert(playerList, player.Name)
    end
end

local TargetDropdown = GoldFarmTab:CreateDropdown({
    Name = "target",
    Options = playerList,
    CurrentOption = "Nearest Player",
    Flag = "TargetPlayer",
    Callback = function(Option)
        selectedTarget = Option
    end,
})

local RefreshButton = GoldFarmTab:CreateButton({
    Name = "refresh players",
    Callback = function()
        playerList = {"Nearest Player"}
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                table.insert(playerList, player.Name)
            end
        end
        
        TargetDropdown:Set(playerList)
        print("[xes] player list refreshed")
    end,
})

local FarmSettingsSection = GoldFarmTab:CreateSection("farm settings")

local DistanceSlider = GoldFarmTab:CreateSlider({
    Name = "distance",
    Range = {0, 15},
    Increment = 1,
    CurrentValue = 6,
    Flag = "FarmDistance",
    Callback = function(Value)
        farmDistance = Value
    end,
})

local HeightSlider = GoldFarmTab:CreateSlider({
    Name = "height offset",
    Range = {0, 15},
    Increment = 1,
    CurrentValue = 2,
    Flag = "HeightOffset",
    Callback = function(Value)
        heightOffset = Value
    end,
})

local FarmControlSection = GoldFarmTab:CreateSection("farm control")

local GoldFarmToggle = GoldFarmTab:CreateToggle({
    Name = "auto farm player",
    CurrentValue = false,
    Flag = "GoldFarm",
    Callback = function(Value)
        goldFarmEnabled = Value
        
        if Value then
            if not desyncEnabled then
                print("[xes] warning: desync not enabled!")
            end
            
            -- Start farm loop
            if Connections['GoldFarm'] then
                Connections['GoldFarm']:Disconnect()
            end
            
            Connections['GoldFarm'] = RunService.RenderStepped:Connect(function()
                if not goldFarmEnabled then return end
                
                local target = getTargetPlayer()
                if target then
                    moveToTarget(target)
                    
                    local distance = getPlayerDistance(LocalPlayer, target)
                    
                    -- Auto skills based on distance
                    if autoSkill1 and distance <= skill1Distance then
                        useSkill(1)
                    end
                    if autoSkill2 and distance <= skill2Distance then
                        useSkill(2)
                    end
                    if autoSkill3 and distance <= skill3Distance then
                        useSkill(3)
                    end
                    if autoSkill4 and distance <= skill4Distance then
                        useSkill(4)
                    end
                end
            end)
        else
            -- Stop farm loop
            if Connections['GoldFarm'] then
                Connections['GoldFarm']:Disconnect()
                Connections['GoldFarm'] = nil
            end
        end
    end,
})

local LockOnToggle = GoldFarmTab:CreateToggle({
    Name = "lock on target",
    CurrentValue = false,
    Flag = "LockOn",
    Callback = function(Value)
        lockOnEnabled = Value
        
        if Value then
            -- Start lock on loop
            if Connections['LockOn'] then
                Connections['LockOn']:Disconnect()
            end
            
            Connections['LockOn'] = RunService.RenderStepped:Connect(function()
                if not lockOnEnabled then return end
                
                local target = getTargetPlayer()
                if target then
                    lookAtTarget(target)
                end
            end)
        else
            -- Stop lock on loop
            if Connections['LockOn'] then
                Connections['LockOn']:Disconnect()
                Connections['LockOn'] = nil
            end
        end
    end,
})

-- FIXED: Auto Attack uses proper remote instead of mouse1press
local AutoAttackToggle = GoldFarmTab:CreateToggle({
    Name = "auto attack (m1)",
    CurrentValue = false,
    Flag = "AutoAttack",
    Callback = function(Value)
        autoAttackEnabled = Value
        
        if Value then
            if Connections['AutoAttack'] then
                Connections['AutoAttack']:Disconnect()
            end
            
            Connections['AutoAttack'] = task.spawn(function()
                while autoAttackEnabled do
                    attackTarget() -- Uses the proper remote now
                    task.wait(0.1)
                end
            end)
        else
            if Connections['AutoAttack'] then
                pcall(function() task.cancel(Connections['AutoAttack']) end)
                Connections['AutoAttack'] = nil
            end
        end
    end,
})

local AutoGToggle = GoldFarmTab:CreateToggle({
    Name = "auto g",
    CurrentValue = false,
    Flag = "AutoG",
    Callback = function(Value)
        autoGEnabled = Value
        
        if Value then
            if Connections['AutoG'] then
                Connections['AutoG']:Disconnect()
            end
            
            Connections['AutoG'] = task.spawn(function()
                while autoGEnabled do
                    spamG()
                    task.wait(0.1)
                end
            end)
        else
            if Connections['AutoG'] then
                pcall(function() task.cancel(Connections['AutoG']) end)
                Connections['AutoG'] = nil
            end
        end
    end,
})

local SkillsSection = GoldFarmTab:CreateSection("auto skills")

local Skill1Toggle = GoldFarmTab:CreateToggle({
    Name = "skill 1",
    CurrentValue = false,
    Flag = "Skill1",
    Callback = function(Value)
        autoSkill1 = Value
    end,
})

local Skill1DistanceSlider = GoldFarmTab:CreateSlider({
    Name = "skill 1 distance",
    Range = {0, 100},
    Increment = 5,
    CurrentValue = 50,
    Flag = "Skill1Distance",
    Callback = function(Value)
        skill1Distance = Value
    end,
})

local Skill2Toggle = GoldFarmTab:CreateToggle({
    Name = "skill 2",
    CurrentValue = false,
    Flag = "Skill2",
    Callback = function(Value)
        autoSkill2 = Value
    end,
})

local Skill2DistanceSlider = GoldFarmTab:CreateSlider({
    Name = "skill 2 distance",
    Range = {0, 100},
    Increment = 5,
    CurrentValue = 50,
    Flag = "Skill2Distance",
    Callback = function(Value)
        skill2Distance = Value
    end,
})

local Skill3Toggle = GoldFarmTab:CreateToggle({
    Name = "skill 3",
    CurrentValue = false,
    Flag = "Skill3",
    Callback = function(Value)
        autoSkill3 = Value
    end,
})

local Skill3DistanceSlider = GoldFarmTab:CreateSlider({
    Name = "skill 3 distance",
    Range = {0, 100},
    Increment = 5,
    CurrentValue = 50,
    Flag = "Skill3Distance",
    Callback = function(Value)
        skill3Distance = Value
    end,
})

local Skill4Toggle = GoldFarmTab:CreateToggle({
    Name = "skill 4",
    CurrentValue = false,
    Flag = "Skill4",
    Callback = function(Value)
        autoSkill4 = Value
    end,
})

local Skill4DistanceSlider = GoldFarmTab:CreateSlider({
    Name = "skill 4 distance",
    Range = {0, 100},
    Increment = 5,
    CurrentValue = 50,
    Flag = "Skill4Distance",
    Callback = function(Value)
        skill4Distance = Value
    end,
})

-- Exploits Tab
local ExploitsTab = Window:CreateTab("exploits", 4483362458)

local ExploitsInfoLabel = ExploitsTab:CreateLabel("These skills hit everyone on the map")

-- Projectile variables - always enabled
local characterProjectiles = {
    YusukeSpiritGun = false,
    YusukeDevilGun = false,
    DekuDelawareSmash = false,
    GojoHollowPurple = false,
    NarutoFireball = false,
    RengokuFlamingTiger = false,
    FireSkill = false,
    Misaka = false,
    Bakugo = false,
    KazumaSniper = false,
    BrolyEraser = false,
    GaaraTsunami = false,
    SinonArrow = false,
    GojoBlueUlt = false,
    AcceleratorQuake = false,
    AkainuFist = false,
    SuperDummyKillBlock = false,
    BrolyMeteor = false,
    JosephJeep = false,
    JosephBarrel = false,
    WeatherReportTornado = false,
    GutsRepeater = false,
    IchigoTSGetsuga = false,
    KisameShark = false,
    JosephHamon = false,
    OldJosephBarrel = false,
    OldJosephJeep = false,
}

local function runProjectile(obj)
    local shouldManipulate = false
    
    -- Ball projectiles
    if obj.Name == "Ball" then
        if characterProjectiles.YusukeSpiritGun or 
           characterProjectiles.YusukeDevilGun or
           characterProjectiles.DekuDelawareSmash or
           characterProjectiles.GojoHollowPurple or
           characterProjectiles.NarutoFireball or
           characterProjectiles.RengokuFlamingTiger or
           characterProjectiles.AcceleratorQuake then
            shouldManipulate = true
        end
    -- Fist (Akainu)
    elseif obj.Name == "Fist" and characterProjectiles.AkainuFist then
        shouldManipulate = true
    -- Part (Super Dummy Kill Block)
    elseif obj.Name == "Part" and characterProjectiles.SuperDummyKillBlock then
        shouldManipulate = true
    -- Genki (Broly Meteor Shower)
    elseif obj.Name == "Genki" and characterProjectiles.BrolyMeteor then
        shouldManipulate = true
    -- Jeep (Joseph)
    elseif obj.Name == "Jeep" and characterProjectiles.JosephJeep then
        shouldManipulate = true
    -- Barrel (Joseph Barrel)
    elseif obj.Name == "Barrel" and characterProjectiles.JosephBarrel then
        shouldManipulate = true
    -- Nado (Weather Report Tornado)
    elseif obj.Name == "Nado" and characterProjectiles.WeatherReportTornado then
        shouldManipulate = true
    -- Arrow (Guts Repeater)
    elseif obj.Name == "Arrow" and characterProjectiles.GutsRepeater then
        shouldManipulate = true
    -- NewGetsuga (Ichigo TS Getsuga)
    elseif obj.Name == "NewGetsuga" and characterProjectiles.IchigoTSGetsuga then
        shouldManipulate = true
    -- EraserBlow (Broly)
    elseif obj.Name == "EraserBlow" and characterProjectiles.BrolyEraser then
        shouldManipulate = true
    -- Coolljamie13Fire
    elseif obj.Name == "Coolljamie13Fire" and characterProjectiles.FireSkill then
        shouldManipulate = true
    -- Coin (Misaka)
    elseif obj.Name == "Coin" and characterProjectiles.Misaka then
        shouldManipulate = true
    -- GauntletBlast (Bakugo)
    elseif obj.Name == "GauntletBlast" and characterProjectiles.Bakugo then
        shouldManipulate = true
    -- Soru
    elseif obj.Name == "Soru" then
        shouldManipulate = true
    -- Model
    elseif obj.Name == "Model" then
        shouldManipulate = true
    -- KazumaArrow (Kazuma)
    elseif obj.Name == "KazumaArrow" and characterProjectiles.KazumaSniper then
        shouldManipulate = true
    -- Tsunami (Gaara)
    elseif obj.Name == "Tsunami" and characterProjectiles.GaaraTsunami then
        shouldManipulate = true
    -- SinonSmallArrow, Sniper1, Sniper2 (Sinon)
    elseif (obj.Name == "SinonSmallArrow" or obj.Name == "Sniper1" or obj.Name == "Sniper2") and characterProjectiles.SinonArrow then
        shouldManipulate = true
    -- GrabBallMax (Gojo Blue Ult)
    elseif obj.Name == "GrabBallMax" and characterProjectiles.GojoBlueUlt then
        shouldManipulate = true
    -- Shark (Kisame)
    elseif obj.Name == "Shark" and characterProjectiles.KisameShark then
        shouldManipulate = true
    -- HamonCap (Joseph)
    elseif obj.Name == "HamonCap" and characterProjectiles.JosephHamon then
        shouldManipulate = true
    -- Barrel (Old Joseph)
    elseif obj.Name == "Barrel" and characterProjectiles.OldJosephBarrel then
        shouldManipulate = true
    -- Jeep (Old Joseph)
    elseif obj.Name == "Jeep" and characterProjectiles.OldJosephJeep then
        shouldManipulate = true
    end
    
    if not shouldManipulate then return end

    for _, v in ipairs(obj:GetDescendants()) do
        if v:IsA("BodyVelocity") then
            v.Velocity = Vector3.zero
        end
    end

    if obj:IsA("BasePart") then
        obj.AssemblyLinearVelocity = Vector3.zero
        obj.AssemblyAngularVelocity = Vector3.zero
    end

    task.spawn(function()
        local Live = workspace:WaitForChild("Live")
        while obj.Parent do
            for _, target in ipairs(Live:GetChildren()) do
                if not obj.Parent then return end

                local hit = target:IsA("Model") and target.PrimaryPart or target:IsA("BasePart") and target

                if hit then
                    if obj:IsA("Model") then
                        obj:PivotTo(hit.CFrame)
                    else
                        obj.CFrame = hit.CFrame
                    end
                    task.wait()
                end
            end
        end
    end)
end

local function setupProjectileListener()
    if Connections['ProjectileListener'] then
        Connections['ProjectileListener']:Disconnect()
    end
    
    local Thrown = workspace:WaitForChild("Thrown")
    
    for _, obj in ipairs(Thrown:GetChildren()) do
        runProjectile(obj)
    end
    
    Connections['ProjectileListener'] = Thrown.ChildAdded:Connect(runProjectile)
end

setupProjectileListener()

local SpiritGunSection = ExploitsTab:CreateSection("Spirit Gun")

local YusukeToggle = ExploitsTab:CreateToggle({
    Name = "Yusuke Spirit Gun Auto Track",
    CurrentValue = false,
    Flag = "YusukeSpirit",
    Callback = function(Value)
        characterProjectiles.YusukeSpiritGun = Value
    end,
})

local DekuSection = ExploitsTab:CreateSection("Deku")

local DekuToggle = ExploitsTab:CreateToggle({
    Name = "Deku | Delaware Smash",
    CurrentValue = false,
    Flag = "DekuDelaware",
    Callback = function(Value)
        characterProjectiles.DekuDelawareSmash = Value
    end,
})

local GojoSection = ExploitsTab:CreateSection("Gojo")

local GojoToggle = ExploitsTab:CreateToggle({
    Name = "Gojo | Hollow Purple",
    CurrentValue = false,
    Flag = "GojoHollow",
    Callback = function(Value)
        characterProjectiles.GojoHollowPurple = Value
    end,
})

local FireSkillSection = ExploitsTab:CreateSection("Fire Skill")

local FireToggle = ExploitsTab:CreateToggle({
    Name = "Fire | Itachi | Shisui | Rengoku",
    CurrentValue = false,
    Flag = "FireSkill",
    Callback = function(Value)
        characterProjectiles.FireSkill = Value
    end,
})

local MisakaSection = ExploitsTab:CreateSection("Misaka")

local MisakaToggle = ExploitsTab:CreateToggle({
    Name = "Misaka | Coin (Bugged)",
    CurrentValue = false,
    Flag = "MisakaCoin",
    Callback = function(Value)
        characterProjectiles.Misaka = Value
    end,
})

local BakugoSection = ExploitsTab:CreateSection("Bakugo")

local BakugoToggle = ExploitsTab:CreateToggle({
    Name = "Bakugo | Gauntlet Blast",
    CurrentValue = false,
    Flag = "BakugoGauntlet",
    Callback = function(Value)
        characterProjectiles.Bakugo = Value
    end,
})

local BrolySection = ExploitsTab:CreateSection("Broly")

local BrolyToggle = ExploitsTab:CreateToggle({
    Name = "Broly | Eraser Blow",
    CurrentValue = false,
    Flag = "BrolyEraser",
    Callback = function(Value)
        characterProjectiles.BrolyEraser = Value
    end,
})

local KazumaSection = ExploitsTab:CreateSection("Kazuma")

local KazumaToggle = ExploitsTab:CreateToggle({
    Name = "Kazuma | Sniper Arrow",
    CurrentValue = false,
    Flag = "KazumaSniper",
    Callback = function(Value)
        characterProjectiles.KazumaSniper = Value
    end,
})

local GaaraSection = ExploitsTab:CreateSection("Gaara")

local GaaraToggle = ExploitsTab:CreateToggle({
    Name = "Gaara | Tsunami",
    CurrentValue = false,
    Flag = "GaaraTsunami",
    Callback = function(Value)
        characterProjectiles.GaaraTsunami = Value
    end,
})

local SinonSection = ExploitsTab:CreateSection("Sinon")

local SinonToggle = ExploitsTab:CreateToggle({
    Name = "Sinon | Small Arrow",
    CurrentValue = false,
    Flag = "SinonArrow",
    Callback = function(Value)
        characterProjectiles.SinonArrow = Value
    end,
})

local GojoBlueUltSection = ExploitsTab:CreateSection("Gojo Blue Ult")

local GojoBlueUltToggle = ExploitsTab:CreateToggle({
    Name = "Gojo | Blue Ult",
    CurrentValue = false,
    Flag = "GojoBlueUlt",
    Callback = function(Value)
        characterProjectiles.GojoBlueUlt = Value
    end,
})

local AcceleratorSection = ExploitsTab:CreateSection("Accelerator")

local AcceleratorToggle = ExploitsTab:CreateToggle({
    Name = "Accelerator | Quake",
    CurrentValue = false,
    Flag = "AcceleratorQuake",
    Callback = function(Value)
        characterProjectiles.AcceleratorQuake = Value
    end,
})

local AkainuSection = ExploitsTab:CreateSection("Akainu")

local AkainuToggle = ExploitsTab:CreateToggle({
    Name = "Akainu | Fist",
    CurrentValue = false,
    Flag = "AkainuFist",
    Callback = function(Value)
        characterProjectiles.AkainuFist = Value
    end,
})

local AkainuHitboxToggle = ExploitsTab:CreateToggle({
    Name = "Akainu | Fist Hitbox Expander",
    CurrentValue = false,
    Flag = "AkainuHitbox",
    Callback = function(Value)
        if Value then
            if Connections['AkainuHitbox'] then
                Connections['AkainuHitbox']:Disconnect()
            end
            
            local folder = workspace:WaitForChild("Thrown")
            
            Connections['AkainuHitbox'] = folder.ChildAdded:Connect(function(fist)
                if fist.Name == "Fist" and fist:IsA("MeshPart") then
                    -- MAX practical size (safe)
                    fist.Size = Vector3.new(2000, 2000, 2000)
                    
                    fist.Transparency = 1
                    fist.CanCollide = false
                    fist.CanTouch = true
                    fist.CanQuery = true
                    fist.Massless = true
                end
            end)
        else
            if Connections['AkainuHitbox'] then
                Connections['AkainuHitbox']:Disconnect()
                Connections['AkainuHitbox'] = nil
            end
        end
    end,
})

local SuperDummySection = ExploitsTab:CreateSection("Super Dummy")

local SuperDummyToggle = ExploitsTab:CreateToggle({
    Name = "Super Dummy | Kill Block",
    CurrentValue = false,
    Flag = "SuperDummyKillBlock",
    Callback = function(Value)
        characterProjectiles.SuperDummyKillBlock = Value
    end,
})

local BrolyMeteorSection = ExploitsTab:CreateSection("Broly Meteor")

local BrolyMeteorToggle = ExploitsTab:CreateToggle({
    Name = "Broly | Meteor Shower",
    CurrentValue = false,
    Flag = "BrolyMeteor",
    Callback = function(Value)
        characterProjectiles.BrolyMeteor = Value
    end,
})

local JosephSection = ExploitsTab:CreateSection("Joseph")

local JosephToggle = ExploitsTab:CreateToggle({
    Name = "Joseph | Jeep",
    CurrentValue = false,
    Flag = "JosephJeep",
    Callback = function(Value)
        characterProjectiles.JosephJeep = Value
    end,
})

local JosephBarrelToggle = ExploitsTab:CreateToggle({
    Name = "Joseph | Barrel",
    CurrentValue = false,
    Flag = "JosephBarrel",
    Callback = function(Value)
        characterProjectiles.JosephBarrel = Value
    end,
})

local BakugoInfDashSection = ExploitsTab:CreateSection("Bakugo Abilities")

local BakugoInfDashToggle = ExploitsTab:CreateToggle({
    Name = "Bakugo | Infinite Dash",
    CurrentValue = false,
    Flag = "BakugoInfDash",
    Callback = function(Value)
        if Value then
            if Connections['BakugoInfDash'] then
                Connections['BakugoInfDash']:Disconnect()
            end
            
            Connections['BakugoInfDash'] = task.spawn(function()
                while task.wait(0.1) do
                    if not Connections['BakugoInfDash'] then break end
                    
                    pcall(function()
                        local args = {
                            "dodge",
                            {
                                explod = Enum.KeyCode.W
                            }
                        }
                        LocalPlayer:WaitForChild("Backpack"):WaitForChild("ServerTraits"):WaitForChild("Input"):FireServer(unpack(args))
                    end)
                end
            end)
        else
            if Connections['BakugoInfDash'] then
                pcall(function() task.cancel(Connections['BakugoInfDash']) end)
                Connections['BakugoInfDash'] = nil
            end
        end
    end,
})

local NatsuInfDashToggle = ExploitsTab:CreateToggle({
    Name = "Natsu | Infinite Dash (Awakening)",
    CurrentValue = false,
    Flag = "NatsuInfDash",
    Callback = function(Value)
        if Value then
            if Connections['NatsuInfDash'] then
                Connections['NatsuInfDash']:Disconnect()
            end
            
            Connections['NatsuInfDash'] = task.spawn(function()
                while task.wait(0.1) do
                    if not Connections['NatsuInfDash'] then break end
                    
                    pcall(function()
                        local char = LocalPlayer.Character
                        if char and char:FindFirstChild("HumanoidRootPart") then
                            local hrp = char.HumanoidRootPart
                            
                            local args = {
                                "dodge",
                                {
                                    pos = hrp.CFrame
                                }
                            }
                            LocalPlayer:WaitForChild("Backpack"):WaitForChild("ServerTraits"):WaitForChild("Input"):FireServer(unpack(args))
                        end
                    end)
                end
            end)
        else
            if Connections['NatsuInfDash'] then
                pcall(function() task.cancel(Connections['NatsuInfDash']) end)
                Connections['NatsuInfDash'] = nil
            end
        end
    end,
})

local KisameSection = ExploitsTab:CreateSection("Kisame")

local KisameToggle = ExploitsTab:CreateToggle({
    Name = "Kisame | Shark",
    CurrentValue = false,
    Flag = "KisameShark",
    Callback = function(Value)
        characterProjectiles.KisameShark = Value
    end,
})

local NanamiSection = ExploitsTab:CreateSection("Nanami")

local NanamiBlackFlashToggle = ExploitsTab:CreateToggle({
    Name = "Nanami | Auto Black Flash",
    CurrentValue = false,
    Flag = "NanamiAutoBlackFlash",
    Callback = function(Value)
        if Value then
            local NanamiEvent = ReplicatedStorage:WaitForChild("NanamiCheck")
            local CutGUI = ReplicatedStorage:WaitForChild("NanamiCutGUI")
            local Live = workspace:WaitForChild('Live')
            
            NanamiEvent.OnClientInvoke = function(Target, TimeDur, User)
                local TempGUI = CutGUI:Clone()
                TempGUI.MainBar.Rotation = -80
                TempGUI.Parent = Live[Target.Name].HumanoidRootPart
                TempGUI.Adornee = Live[Target.Name].HumanoidRootPart
                local MainBar = TempGUI.MainBar
                local Cutter = MainBar.Cutter
                local Temp1, Temp2, Temp3 = false, false, false
                
                local InputConnection = UserInputService.InputBegan:Connect(function(InputObject)
                    if not Temp1 then
                        if InputObject.UserInputType == Enum.UserInputType.MouseButton1 or InputObject.KeyCode == Enum.KeyCode.ButtonB then
                            if Temp2 then
                                Temp3 = true
                                return
                            end
                            Temp1 = true
                        end
                    end
                end)
                
                local Counter = .005
                local Time = 0
                
                while Counter < 1 and (User:GetAttribute('NANAMIAIM') and not (Temp3 or Temp1)) do
                    local Timed = task.wait()
                    local Division = Timed / TimeDur
                    local Difference = math.abs(.7 - Counter)
                    
                    if Counter < .7 then
                        MainBar.Rotation = Counter/.7*80-80
                    else
                        MainBar.Rotation = 0
                    end
                    
                    if Difference < .025 then
                        Division = Division / 8
                    elseif Difference < .05 then
                        Division = Division / 4
                    end
                    
                    Counter = Counter + Division
                    Cutter.Position = UDim2.fromScale(Counter, .5)
                    
                    if Difference < .02 then
                        Temp2 = true
                        Temp3 = true
                    else
                        Temp2 = false
                    end
                    
                    if Temp2 then
                        Time = Time + Timed
                    end
                end
                
                InputConnection:Disconnect()
                
                if Temp3 and User:GetAttribute('NANAMIAIM') then
                    Cutter.Position = UDim2.fromScale(.7, .5)
                    TweenService:Create(TempGUI, TweenInfo.new(.25), {['Size'] = UDim2.new(10, 200, 10, 200)}):Play()
                    Cutter.Size = UDim2.fromScale(.016, 12)
                    TweenService:Create(Cutter, TweenInfo.new(0.5, Enum.EasingStyle.Linear), {
                        ['Size'] = UDim2.fromScale(0, 24),
                        ['BackgroundColor3'] = Color3.new(1, 0, 0),
                        ['BackgroundTransparency'] = 1
                    }):Play()
                    
                    local ColorCorrection = Instance.new("ColorCorrectionEffect", game.Lighting)
                    ColorCorrection.TintColor = Color3.new(0, 0, 0)
                    Debris:AddItem(ColorCorrection, .15)
                end
                
                Debris:AddItem(TempGUI, .5)
                return Temp3
            end
        end
    end,
})

local WeatherReportSection = ExploitsTab:CreateSection("Weather Report")

local WeatherReportToggle = ExploitsTab:CreateToggle({
    Name = "Weather Report | Tornado",
    CurrentValue = false,
    Flag = "WeatherReportTornado",
    Callback = function(Value)
        characterProjectiles.WeatherReportTornado = Value
    end,
})

local GutsSection = ExploitsTab:CreateSection("Guts")

local GutsRepeaterToggle = ExploitsTab:CreateToggle({
    Name = "Guts | Repeater",
    CurrentValue = false,
    Flag = "GutsRepeater",
    Callback = function(Value)
        characterProjectiles.GutsRepeater = Value
    end,
})

local IchigoTSSection = ExploitsTab:CreateSection("Ichigo TS")

local IchigoTSGetsugaToggle = ExploitsTab:CreateToggle({
    Name = "Ichigo TS | Getsuga",
    CurrentValue = false,
    Flag = "IchigoTSGetsuga",
    Callback = function(Value)
        characterProjectiles.IchigoTSGetsuga = Value
    end,
})

-- Misc Tab
local MiscTab = Window:CreateTab("misc", 4483362458)

local DashesSection = MiscTab:CreateSection("Dashes")

local DashesInfoLabel = MiscTab:CreateLabel("You can use all these dashes with any character reset to pick a new dash")

local DisableTempMeterSection = MiscTab:CreateSection("Utilities")

local DisableTempMeterToggle = MiscTab:CreateToggle({
    Name = "Disable Temp Meter",
    CurrentValue = false,
    Flag = "DisableTempMeter",
    Callback = function(Value)
        if Value then
            if Connections['DisableTempMeter'] then
                Connections['DisableTempMeter']:Disconnect()
            end
            
            local alternateValue = 10
            
            Connections['DisableTempMeter'] = task.spawn(function()
                while task.wait(0.01) do
                    if not Connections['DisableTempMeter'] then break end
                    
                    pcall(function()
                        local Live = workspace:FindFirstChild("Live")
                        if Live then
                            local ardrisworld = Live:FindFirstChild("ardrisworld")
                            if ardrisworld then
                                local tempMeter = ardrisworld:FindFirstChild("TemperatureMeter")
                                if tempMeter and tempMeter:IsA("IntConstrainedValue") then
                                    -- Alternate between 10 and 15
                                    tempMeter.Value = alternateValue
                                    alternateValue = alternateValue == 10 and 15 or 10
                                end
                            end
                        end
                    end)
                end
            end)
        else
            if Connections['DisableTempMeter'] then
                pcall(function() task.cancel(Connections['DisableTempMeter']) end)
                Connections['DisableTempMeter'] = nil
            end
        end
    end,
})

local KiritsuguDashesToggle = MiscTab:CreateToggle({
    Name = "Kiritsugu Dashes",
    CurrentValue = false,
    Flag = "KiritsuguDashes",
    Callback = function(Value)
        if Value then
            if Connections['KiritsuguDashes'] then
                Connections['KiritsuguDashes']:Disconnect()
            end
            
            Connections['KiritsuguDashes'] = task.spawn(function()
                while task.wait(0.05) do
                    if not Connections['KiritsuguDashes'] then break end
                    
                    pcall(function()
                        -- Ensure Live exists
                        local Live = workspace:FindFirstChild("Live")
                        if not Live then
                            Live = Instance.new("Folder")
                            Live.Name = "Live"
                            Live.Parent = workspace
                        end
                        
                        -- Ensure ardrisworld exists
                        local ardrisworld = Live:FindFirstChild("ardrisworld")
                        if not ardrisworld then
                            ardrisworld = Instance.new("Folder")
                            ardrisworld.Name = "ardrisworld"
                            ardrisworld.Parent = Live
                        end
                        
                        -- Function to ensure AccelDodges exists
                        local function ensureAccelDodges()
                            if not ardrisworld:FindFirstChild("AccelDodges") then
                                local accelDodges = Instance.new("Folder")
                                accelDodges.Name = "AccelDodges"
                                accelDodges.Parent = ardrisworld
                            end
                        end
                        
                        -- Initial check
                        ensureAccelDodges()
                        
                        -- Re-create if deleted
                        if not Connections['AccelDodgesListener'] then
                            Connections['AccelDodgesListener'] = ardrisworld.ChildRemoved:Connect(function(child)
                                if child.Name == "AccelDodges" and Connections['KiritsuguDashes'] then
                                    task.wait()
                                    ensureAccelDodges()
                                end
                            end)
                        end
                    end)
                end
            end)
        else
            if Connections['KiritsuguDashes'] then
                pcall(function() task.cancel(Connections['KiritsuguDashes']) end)
                Connections['KiritsuguDashes'] = nil
            end
            
            if Connections['AccelDodgesListener'] then
                Connections['AccelDodgesListener']:Disconnect()
                Connections['AccelDodgesListener'] = nil
            end
            
            -- Remove AccelDodges folder when disabled
            pcall(function()
                local Live = workspace:FindFirstChild("Live")
                if Live then
                    local ardrisworld = Live:FindFirstChild("ardrisworld")
                    if ardrisworld then
                        local accelDodges = ardrisworld:FindFirstChild("AccelDodges")
                        if accelDodges then
                            accelDodges:Destroy()
                        end
                    end
                end
            end)
        end
    end,
})

local UltraInstinctDashToggle = MiscTab:CreateToggle({
    Name = "Ultra Instinct Dash",
    CurrentValue = false,
    Flag = "UltraInstinctDash",
    Callback = function(Value)
        if Value then
            if Connections['UltraInstinctDash'] then
                Connections['UltraInstinctDash']:Disconnect()
            end
            
            Connections['UltraInstinctDash'] = task.spawn(function()
                while task.wait(0.05) do
                    if not Connections['UltraInstinctDash'] then break end
                    
                    pcall(function()
                        local Live = workspace:FindFirstChild("Live")
                        if not Live then
                            Live = Instance.new("Folder")
                            Live.Name = "Live"
                            Live.Parent = workspace
                        end
                        
                        local ardrisworld = Live:FindFirstChild("ardrisworld")
                        if not ardrisworld then
                            ardrisworld = Instance.new("Folder")
                            ardrisworld.Name = "ardrisworld"
                            ardrisworld.Parent = Live
                        end
                        
                        local function ensureUIDodge()
                            if not ardrisworld:FindFirstChild("UIDodge") then
                                local uiDodge = Instance.new("Folder")
                                uiDodge.Name = "UIDodge"
                                uiDodge.Parent = ardrisworld
                            end
                        end
                        
                        ensureUIDodge()
                        
                        if not Connections['UIDodgeListener'] then
                            Connections['UIDodgeListener'] = ardrisworld.ChildRemoved:Connect(function(child)
                                if child.Name == "UIDodge" and Connections['UltraInstinctDash'] then
                                    task.wait()
                                    ensureUIDodge()
                                end
                            end)
                        end
                    end)
                end
            end)
        else
            if Connections['UltraInstinctDash'] then
                pcall(function() task.cancel(Connections['UltraInstinctDash']) end)
                Connections['UltraInstinctDash'] = nil
            end
            
            if Connections['UIDodgeListener'] then
                Connections['UIDodgeListener']:Disconnect()
                Connections['UIDodgeListener'] = nil
            end
            
            pcall(function()
                local Live = workspace:FindFirstChild("Live")
                if Live then
                    local ardrisworld = Live:FindFirstChild("ardrisworld")
                    if ardrisworld then
                        local uiDodge = ardrisworld:FindFirstChild("UIDodge")
                        if uiDodge then
                            uiDodge:Destroy()
                        end
                    end
                end
            end)
        end
    end,
})

local FloatPassiveToggle = MiscTab:CreateToggle({
    Name = "Float Passive",
    CurrentValue = false,
    Flag = "FloatPassive",
    Callback = function(Value)
        if Value then
            if Connections['FloatPassive'] then
                Connections['FloatPassive']:Disconnect()
            end
            
            Connections['FloatPassive'] = task.spawn(function()
                while task.wait(0.05) do
                    if not Connections['FloatPassive'] then break end
                    
                    pcall(function()
                        local Live = workspace:FindFirstChild("Live")
                        if not Live then
                            Live = Instance.new("Folder")
                            Live.Name = "Live"
                            Live.Parent = workspace
                        end
                        
                        local ardrisworld = Live:FindFirstChild("ardrisworld")
                        if not ardrisworld then
                            ardrisworld = Instance.new("Folder")
                            ardrisworld.Name = "ardrisworld"
                            ardrisworld.Parent = Live
                        end
                        
                        local function ensureFloatPassive()
                            if not ardrisworld:FindFirstChild("FLOATPASSIVE") then
                                local floatPassive = Instance.new("Folder")
                                floatPassive.Name = "FLOATPASSIVE"
                                floatPassive.Parent = ardrisworld
                            end
                        end
                        
                        ensureFloatPassive()
                        
                        if not Connections['FloatPassiveListener'] then
                            Connections['FloatPassiveListener'] = ardrisworld.ChildRemoved:Connect(function(child)
                                if child.Name == "FLOATPASSIVE" and Connections['FloatPassive'] then
                                    task.wait()
                                    ensureFloatPassive()
                                end
                            end)
                        end
                    end)
                end
            end)
        else
            if Connections['FloatPassive'] then
                pcall(function() task.cancel(Connections['FloatPassive']) end)
                Connections['FloatPassive'] = nil
            end
            
            if Connections['FloatPassiveListener'] then
                Connections['FloatPassiveListener']:Disconnect()
                Connections['FloatPassiveListener'] = nil
            end
            
            pcall(function()
                local Live = workspace:FindFirstChild("Live")
                if Live then
                    local ardrisworld = Live:FindFirstChild("ardrisworld")
                    if ardrisworld then
                        local floatPassive = ardrisworld:FindFirstChild("FLOATPASSIVE")
                        if floatPassive then
                            floatPassive:Destroy()
                        end
                    end
                end
            end)
        end
    end,
})

local BakugoDashToggle = MiscTab:CreateToggle({
    Name = "Bakugo Dash",
    CurrentValue = false,
    Flag = "BakugoDash",
    Callback = function(Value)
        if Value then
            if Connections['BakugoDash'] then
                Connections['BakugoDash']:Disconnect()
            end
            
            Connections['BakugoDash'] = task.spawn(function()
                while task.wait(0.05) do
                    if not Connections['BakugoDash'] then break end
                    
                    pcall(function()
                        local Live = workspace:FindFirstChild("Live")
                        if not Live then
                            Live = Instance.new("Folder")
                            Live.Name = "Live"
                            Live.Parent = workspace
                        end
                        
                        local ardrisworld = Live:FindFirstChild("ardrisworld")
                        if not ardrisworld then
                            ardrisworld = Instance.new("Folder")
                            ardrisworld.Name = "ardrisworld"
                            ardrisworld.Parent = Live
                        end
                        
                        local function ensureExplodDodge()
                            if not ardrisworld:FindFirstChild("ExplodDodge") then
                                local explodDodge = Instance.new("Folder")
                                explodDodge.Name = "ExplodDodge"
                                explodDodge.Parent = ardrisworld
                            end
                        end
                        
                        ensureExplodDodge()
                        
                        if not Connections['ExplodDodgeListener'] then
                            Connections['ExplodDodgeListener'] = ardrisworld.ChildRemoved:Connect(function(child)
                                if child.Name == "ExplodDodge" and Connections['BakugoDash'] then
                                    task.wait()
                                    ensureExplodDodge()
                                end
                            end)
                        end
                    end)
                end
            end)
        else
            if Connections['BakugoDash'] then
                pcall(function() task.cancel(Connections['BakugoDash']) end)
                Connections['BakugoDash'] = nil
            end
            
            if Connections['ExplodDodgeListener'] then
                Connections['ExplodDodgeListener']:Disconnect()
                Connections['ExplodDodgeListener'] = nil
            end
            
            pcall(function()
                local Live = workspace:FindFirstChild("Live")
                if Live then
                    local ardrisworld = Live:FindFirstChild("ardrisworld")
                    if ardrisworld then
                        local explodDodge = ardrisworld:FindFirstChild("ExplodDodge")
                        if explodDodge then
                            explodDodge:Destroy()
                        end
                    end
                end
            end)
        end
    end,
})

local WuxianDashToggle = MiscTab:CreateToggle({
    Name = "Wuxian Dash",
    CurrentValue = false,
    Flag = "WuxianDash",
    Callback = function(Value)
        if Value then
            if Connections['WuxianDash'] then
                Connections['WuxianDash']:Disconnect()
            end
            
            Connections['WuxianDash'] = task.spawn(function()
                while task.wait(0.05) do
                    if not Connections['WuxianDash'] then break end
                    
                    pcall(function()
                        local Live = workspace:FindFirstChild("Live")
                        if not Live then
                            Live = Instance.new("Folder")
                            Live.Name = "Live"
                            Live.Parent = workspace
                        end
                        
                        local ardrisworld = Live:FindFirstChild("ardrisworld")
                        if not ardrisworld then
                            ardrisworld = Instance.new("Folder")
                            ardrisworld.Name = "ardrisworld"
                            ardrisworld.Parent = Live
                        end
                        
                        local function ensureWuxianDodge()
                            if not ardrisworld:FindFirstChild("WuxianDodge") then
                                local wuxianDodge = Instance.new("Folder")
                                wuxianDodge.Name = "WuxianDodge"
                                wuxianDodge.Parent = ardrisworld
                            end
                        end
                        
                        ensureWuxianDodge()
                        
                        if not Connections['WuxianDodgeListener'] then
                            Connections['WuxianDodgeListener'] = ardrisworld.ChildRemoved:Connect(function(child)
                                if child.Name == "WuxianDodge" and Connections['WuxianDash'] then
                                    task.wait()
                                    ensureWuxianDodge()
                                end
                            end)
                        end
                    end)
                end
            end)
        else
            if Connections['WuxianDash'] then
                pcall(function() task.cancel(Connections['WuxianDash']) end)
                Connections['WuxianDash'] = nil
            end
            
            if Connections['WuxianDodgeListener'] then
                Connections['WuxianDodgeListener']:Disconnect()
                Connections['WuxianDodgeListener'] = nil
            end
            
            pcall(function()
                local Live = workspace:FindFirstChild("Live")
                if Live then
                    local ardrisworld = Live:FindFirstChild("ardrisworld")
                    if ardrisworld then
                        local wuxianDodge = ardrisworld:FindFirstChild("WuxianDodge")
                        if wuxianDodge then
                            wuxianDodge:Destroy()
                        end
                    end
                end
            end)
        end
    end,
})

local GeppoDashToggle = MiscTab:CreateToggle({
    Name = "Geppo Dash",
    CurrentValue = false,
    Flag = "GeppoDash",
    Callback = function(Value)
        if Value then
            if Connections['GeppoDash'] then
                Connections['GeppoDash']:Disconnect()
            end
            
            Connections['GeppoDash'] = task.spawn(function()
                while task.wait(0.05) do
                    if not Connections['GeppoDash'] then break end
                    
                    pcall(function()
                        local Live = workspace:FindFirstChild("Live")
                        if not Live then
                            Live = Instance.new("Folder")
                            Live.Name = "Live"
                            Live.Parent = workspace
                        end
                        
                        local ardrisworld = Live:FindFirstChild("ardrisworld")
                        if not ardrisworld then
                            ardrisworld = Instance.new("Folder")
                            ardrisworld.Name = "ardrisworld"
                            ardrisworld.Parent = Live
                        end
                        
                        local function ensureRokushiki()
                            if not ardrisworld:FindFirstChild("ROKUSHIKI") then
                                local rokushiki = Instance.new("Folder")
                                rokushiki.Name = "ROKUSHIKI"
                                rokushiki.Parent = ardrisworld
                            end
                        end
                        
                        ensureRokushiki()
                        
                        if not Connections['RokushikiListener'] then
                            Connections['RokushikiListener'] = ardrisworld.ChildRemoved:Connect(function(child)
                                if child.Name == "ROKUSHIKI" and Connections['GeppoDash'] then
                                    task.wait()
                                    ensureRokushiki()
                                end
                            end)
                        end
                    end)
                end
            end)
        else
            if Connections['GeppoDash'] then
                pcall(function() task.cancel(Connections['GeppoDash']) end)
                Connections['GeppoDash'] = nil
            end
            
            if Connections['RokushikiListener'] then
                Connections['RokushikiListener']:Disconnect()
                Connections['RokushikiListener'] = nil
            end
            
            pcall(function()
                local Live = workspace:FindFirstChild("Live")
                if Live then
                    local ardrisworld = Live:FindFirstChild("ardrisworld")
                    if ardrisworld then
                        local rokushiki = ardrisworld:FindFirstChild("ROKUSHIKI")
                        if rokushiki then
                            rokushiki:Destroy()
                        end
                    end
                end
            end)
        end
    end,
})

local UssopDashToggle = MiscTab:CreateToggle({
    Name = "Ussop Dash",
    CurrentValue = false,
    Flag = "UssopDash",
    Callback = function(Value)
        if Value then
            if Connections['UssopDash'] then
                Connections['UssopDash']:Disconnect()
            end
            
            Connections['UssopDash'] = task.spawn(function()
                while task.wait(0.05) do
                    if not Connections['UssopDash'] then break end
                    
                    pcall(function()
                        local Live = workspace:FindFirstChild("Live")
                        if not Live then
                            Live = Instance.new("Folder")
                            Live.Name = "Live"
                            Live.Parent = workspace
                        end
                        
                        local ardrisworld = Live:FindFirstChild("ardrisworld")
                        if not ardrisworld then
                            ardrisworld = Instance.new("Folder")
                            ardrisworld.Name = "ardrisworld"
                            ardrisworld.Parent = Live
                        end
                        
                        local function ensureUsopDodge()
                            if not ardrisworld:FindFirstChild("UsopDodge") then
                                local usopDodge = Instance.new("Folder")
                                usopDodge.Name = "UsopDodge"
                                usopDodge.Parent = ardrisworld
                            end
                        end
                        
                        ensureUsopDodge()
                        
                        if not Connections['UsopDodgeListener'] then
                            Connections['UsopDodgeListener'] = ardrisworld.ChildRemoved:Connect(function(child)
                                if child.Name == "UsopDodge" and Connections['UssopDash'] then
                                    task.wait()
                                    ensureUsopDodge()
                                end
                            end)
                        end
                    end)
                end
            end)
        else
            if Connections['UssopDash'] then
                pcall(function() task.cancel(Connections['UssopDash']) end)
                Connections['UssopDash'] = nil
            end
            
            if Connections['UsopDodgeListener'] then
                Connections['UsopDodgeListener']:Disconnect()
                Connections['UsopDodgeListener'] = nil
            end
            
            pcall(function()
                local Live = workspace:FindFirstChild("Live")
                if Live then
                    local ardrisworld = Live:FindFirstChild("ardrisworld")
                    if ardrisworld then
                        local usopDodge = ardrisworld:FindFirstChild("UsopDodge")
                        if usopDodge then
                            usopDodge:Destroy()
                        end
                    end
                end
            end)
        end
    end,
})

local AwakeningDashToggle = MiscTab:CreateToggle({
    Name = "Awakening Dash",
    CurrentValue = false,
    Flag = "AwakeningDash",
    Callback = function(Value)
        if Value then
            if Connections['AwakeningDash'] then
                Connections['AwakeningDash']:Disconnect()
            end
            
            Connections['AwakeningDash'] = task.spawn(function()
                while task.wait(0.05) do
                    if not Connections['AwakeningDash'] then break end
                    
                    pcall(function()
                        local Live = workspace:FindFirstChild("Live")
                        if not Live then
                            Live = Instance.new("Folder")
                            Live.Name = "Live"
                            Live.Parent = workspace
                        end
                        
                        local ardrisworld = Live:FindFirstChild("ardrisworld")
                        if not ardrisworld then
                            ardrisworld = Instance.new("Folder")
                            ardrisworld.Name = "ardrisworld"
                            ardrisworld.Parent = Live
                        end
                        
                        local function ensureVanish()
                            if not ardrisworld:FindFirstChild("Vanish") then
                                local vanish = Instance.new("Folder")
                                vanish.Name = "Vanish"
                                vanish.Parent = ardrisworld
                            end
                        end
                        
                        ensureVanish()
                        
                        if not Connections['VanishListener'] then
                            Connections['VanishListener'] = ardrisworld.ChildRemoved:Connect(function(child)
                                if child.Name == "Vanish" and Connections['AwakeningDash'] then
                                    task.wait()
                                    ensureVanish()
                                end
                            end)
                        end
                    end)
                end
            end)
        else
            if Connections['AwakeningDash'] then
                pcall(function() task.cancel(Connections['AwakeningDash']) end)
                Connections['AwakeningDash'] = nil
            end
            
            if Connections['VanishListener'] then
                Connections['VanishListener']:Disconnect()
                Connections['VanishListener'] = nil
            end
            
            pcall(function()
                local Live = workspace:FindFirstChild("Live")
                if Live then
                    local ardrisworld = Live:FindFirstChild("ardrisworld")
                    if ardrisworld then
                        local vanish = ardrisworld:FindFirstChild("Vanish")
                        if vanish then
                            vanish:Destroy()
                        end
                    end
                end
            end)
        end
    end,
})

-- Initialize auto skip bans (works for all modes)
SetupAutoSkipBans()
