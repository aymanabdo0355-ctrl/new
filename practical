--[[ 
    Xes Hub - Practical Basketball
    UI: Obsidian
]] 

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Stats = game:GetService("Stats")

-- Load Obsidian Library
local repo = "https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()
local ThemeManager = loadstring(game:HttpGet(repo .. "addons/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet(repo .. "addons/SaveManager.lua"))()

-- Wait for Library to be ready
repeat task.wait() until Library.Options and Library.Toggles

local Options = Library.Options
local Toggles = Library.Toggles

local player = Players.LocalPlayer
local AeroRemote = ReplicatedStorage:WaitForChild("Aero"):WaitForChild("AeroRemoteServices"):WaitForChild("InputService"):WaitForChild("Shoot")

local perfectTiming = 0.652
local pingCompensation = 0
local earlyRelease = 0
local movementDelay = 0
local autoShotEnabled = false
local holdingE = false
local startTime = 0
local released = false
local isShooting = false

local dunkTiming = 0.5
local autoDunkEnabled = false
local holdingSpace = false
local dunkStartTime = 0
local dunkReleased = false

local infiniteStaminaEnabled = false

-- Create Window
local Window = Library:CreateWindow({
    Title = "Xes Hub - Basketball",
    Footer = "version: 1.0",
    Icon = 4483362458,
    NotifySide = "Right",
    ShowCustomCursor = true,
})

-- Tabs
local Tabs = {
    Shoot = Window:AddTab("Shoot", "crosshair"),
    Dunk = Window:AddTab("Dunk", "zap"),
    Character = Window:AddTab("Character", "user"),
    ["UI Settings"] = Window:AddTab("UI Settings", "settings"),
}

-- Shoot Tab
local ShootGroup = Tabs.Shoot:AddLeftGroupbox("Auto-Release Settings", "crosshair")
ShootGroup:AddToggle("AutoShotToggle", {Text="Enable Auto-Release", Default=false, Callback=function(Value) autoShotEnabled = Value end})
ShootGroup:AddSlider("TimingSlider", {Text="Release Timing (seconds)", Default=0.652, Min=0.1, Max=2, Rounding=3, Callback=function(Value) perfectTiming = Value end})
ShootGroup:AddInput("TimingInput",{Text="Release Timing Value", Default="0.652", Numeric=true, Callback=function(Value) local val=tonumber(Value) if val then perfectTiming=val Options.TimingSlider:SetValue(val) end end})

local PingGroup = Tabs.Shoot:AddRightGroupbox("Ping Compensation", "wifi")
PingGroup:AddToggle("PingCompToggle", {Text="Auto Ping Compensation", Default=false, Callback=function(Value) 
    if Value then task.spawn(function() while Toggles.PingCompToggle.Value and autoShotEnabled do pingCompensation=Stats.Network.ServerStatsItem["Data Ping"]:GetValue()/2000 task.wait(1) end end) else pingCompensation=0 end 
end})
PingGroup:AddSlider("ManualPingSlider",{Text="Ping Offset (ms)", Default=0, Min=-200, Max=200, Callback=function(Value) pingCompensation=Value/1000 end})
PingGroup:AddInput("ManualPingInput",{Text="Ping Offset Value", Default="0", Numeric=true, Callback=function(Value) local val=tonumber(Value) if val then pingCompensation=val/1000 Options.ManualPingSlider:SetValue(val) end end})

local AdjustmentGroup = Tabs.Shoot:AddLeftGroupbox("Advanced Adjustments", "settings")
AdjustmentGroup:AddSlider("EarlyReleaseSlider",{Text="Early Release (ms)", Default=0, Min=-100, Max=100, Callback=function(Value) earlyRelease=Value/1000 end})
AdjustmentGroup:AddInput("EarlyReleaseInput",{Text="Early Release Value", Default="0", Numeric=true, Callback=function(Value) local val=tonumber(Value) if val then earlyRelease=val/1000 Options.EarlyReleaseSlider:SetValue(val) end end})
AdjustmentGroup:AddSlider("MovementDelaySlider",{Text="Movement Delay (ms)", Default=0, Min=-100, Max=100, Callback=function(Value) movementDelay=Value/1000 end})
AdjustmentGroup:AddInput("MovementDelayInput",{Text="Movement Delay Value", Default="0", Numeric=true, Callback=function(Value) local val=tonumber(Value) if val then movementDelay=val/1000 Options.MovementDelaySlider:SetValue(val) end end})

-- Dunk Tab
local DunkGroup = Tabs.Dunk:AddLeftGroupbox("Auto-Release Settings", "zap")
DunkGroup:AddToggle("AutoDunkToggle",{Text="Enable Auto-Release", Default=false, Callback=function(Value) autoDunkEnabled=Value end})
DunkGroup:AddSlider("DunkTimingSlider",{Text="Release Timing (seconds)", Default=0.5, Min=0.1, Max=2, Rounding=3, Callback=function(Value) dunkTiming=Value end})
DunkGroup:AddInput("DunkTimingInput",{Text="Release Timing Value", Default="0.5", Numeric=true, Callback=function(Value) local val=tonumber(Value) if val then dunkTiming=val Options.DunkTimingSlider:SetValue(val) end end})

-- Character Tab
local CharacterGroup = Tabs.Character:AddLeftGroupbox("Character Enhancements", "user")
CharacterGroup:AddToggle("InfiniteStaminaToggle",{Text="Infinite Stamina", Default=false, Callback=function(Value) infiniteStaminaEnabled=Value end})

-- Infinite Stamina Loop
task.spawn(function()
    while true do
        if infiniteStaminaEnabled then
            local char = player.Character
            if char then
                local comm = char:FindFirstChild("__comm__")
                if comm then
                    local rp = comm:FindFirstChild("RP")
                    if rp then
                        -- If stamina is a VALUE
                        if rp:FindFirstChild("Stamina") then
                            rp.Stamina.Value = 999
                        end

                        -- If stamina is an ATTRIBUTE
                        rp:SetAttribute("Stamina", 999)
                    end
                end
            end
        end
        task.wait(0.05)
    end
end)

-- Input Handling
UserInputService.InputBegan:Connect(function(input,gameProcessed)
    if gameProcessed then return end
    if input.KeyCode==Enum.KeyCode.E then holdingE=true startTime=tick() released=false isShooting=true end
    if input.KeyCode==Enum.KeyCode.Space and autoDunkEnabled then holdingSpace=true dunkStartTime=tick() dunkReleased=false end
end)
UserInputService.InputEnded:Connect(function(input)
    if input.KeyCode==Enum.KeyCode.E then holdingE=false released=false task.delay(0.5,function() isShooting=false end) end
    if input.KeyCode==Enum.KeyCode.Space then holdingSpace=false dunkReleased=false end
end)

RunService.Heartbeat:Connect(function()
    if autoShotEnabled and holdingE and not released then
        local elapsed=tick()-startTime
        local character=player.Character
        local moving=false
        if character then local humanoid=character:FindFirstChildOfClass("Humanoid") if humanoid and humanoid.MoveVector.Magnitude>0 then moving=true end end
        local finalMovementDelay=moving and movementDelay or 0
        local adjustedTiming=perfectTiming-pingCompensation-earlyRelease-finalMovementDelay
        if elapsed>=adjustedTiming then
            AeroRemote:FireServer({{Shoot=false}})
            released=true
            holdingE=false
            task.delay(0.5,function() isShooting=false end)
        end
    end
    if autoDunkEnabled and holdingSpace and not dunkReleased then
        if tick()-dunkStartTime>=dunkTiming then
            local VirtualInputManager=game:GetService("VirtualInputManager")
            VirtualInputManager:SendKeyEvent(false,Enum.KeyCode.Space,false,game)
            dunkReleased=true
            holdingSpace=false
        end
    end
end)

-- UI Settings Tab
local MenuGroup=Tabs["UI Settings"]:AddLeftGroupbox("Menu","wrench")
MenuGroup:AddToggle("KeybindMenuOpen",{Default=Library.KeybindFrame.Visible, Text="Open Keybind Menu", Callback=function(v) Library.KeybindFrame.Visible=v end})
MenuGroup:AddToggle("ShowCustomCursor",{Text="Custom Cursor", Default=true, Callback=function(v) Library.ShowCustomCursor=v end})
MenuGroup:AddDropdown("NotificationSide",{Values={"Left","Right"}, Default="Right", Text="Notification Side", Callback=function(v) Library:SetNotifySide(v) end})
MenuGroup:AddDropdown("DPIDropdown",{Values={"50%","75%","100%","125%","150%","175%","200%"}, Default="100%", Text="DPI Scale", Callback=function(v) Library:SetDPIScale(tonumber(v:gsub("%%",""))) end})
MenuGroup:AddDivider()
MenuGroup:AddLabel("Menu bind"):AddKeyPicker("MenuKeybind",{Default="RightShift", NoUI=true, Text="Menu keybind"})
MenuGroup:AddButton({Text="Unload", Func=function() Library:Unload() end})
Library.ToggleKeybind=Options.MenuKeybind

ThemeManager:SetLibrary(Library)
SaveManager:SetLibrary(Library)
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({"MenuKeybind"})
ThemeManager:SetFolder("XesHub")
SaveManager:SetFolder("XesHub/Basketball")
SaveManager:BuildConfigSection(Tabs["UI Settings"])
ThemeManager:ApplyToTab(Tabs["UI Settings"])

Library:Notify({Title="Xes Hub", Description="Basketball script loaded!", Time=3})
